/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x39ba62,Command as _0x53eb99}from'@ckeditor/ckeditor5-core/dist/index.js';import{FileDialogButtonView as _0x40eb82,MenuBarMenuListItemFileDialogButtonView as _0xb95771,SpinnerView as _0x2e96f2,Notification as _0x1a30a4}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x352614}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0x59e7f9}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x5570ff,uid as _0x2ca18a,logWarning as _0x49ae8b,logError as _0x23bea8}from'@ckeditor/ckeditor5-utils/dist/index.js';function p(_0x3f1042,_0x3a7556){const t=_0x3f1042['t'];switch(_0x3a7556){case'Import\x20from\x20Word':return t('Import\x20from\x20Word');case'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');case'Importing\x20Word\x20document':return t('Importing\x20Word\x20document');default:return _0x3a7556;}}class i extends _0x39ba62{static get['pluginName'](){return'ImportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x4d2b90=this['editor'];_0x4d2b90['ui']['componentFactory']['add']('importWord',()=>{const _0x1d6614=this['_createButton'](_0x40eb82),_0x5344c5=_0x4d2b90['commands']['get']('importWord');return _0x1d6614['bind']('isOn')['to'](_0x5344c5,'isBusy'),_0x1d6614['tooltip']=!0x0,_0x1d6614;}),_0x4d2b90['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0xb95771));}['_createButton'](_0x2c540e){const _0x5a62eb=this['editor'],_0x59173a=_0x5a62eb['commands']['get']('importWord'),_0x825227=new _0x2c540e(_0x5a62eb['locale']),_0x39e9aa=new _0x2e96f2();return _0x825227['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x825227['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22m14\x200\x205\x204.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M10.74\x2018a2.76\x202.76\x200\x200\x201-.469-.5H3V19h9.25v-.374A2.737\x202.737\x200\x200\x201\x2010.74\x2018Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.602.602\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001ZM11.674\x2015.407a.75.75\x200\x201\x200\x201.152.96L14\x2014.96V20h1.5v-5.04l1.174\x201.408a.75.75\x200\x201\x200\x201.152-.96l-2.346-2.816a.95.95\x200\x200\x200-1.46\x200l-2.346\x202.815Z\x22/></svg>\x0a'}),_0x825227['bind']('isEnabled')['to'](_0x59173a),_0x825227['bind']('label')['to'](_0x59173a,'isBusy',_0x2a3063=>p(_0x5a62eb['locale'],_0x2a3063?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x39e9aa['bind']('isVisible')['to'](_0x59173a,'isBusy'),_0x825227['iconView']['bind']('isVisible')['to'](_0x59173a,'isBusy',_0x218933=>!_0x218933),_0x825227['children']['add'](_0x39e9aa),_0x825227['on']('done',(_0x5aca14,_0x127b8b)=>{_0x5a62eb['execute']('importWord',_0x127b8b[0x0],{}),_0x5a62eb['editing']['view']['focus']();}),_0x825227;}}class d extends _0x53eb99{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x299cec){super(_0x299cec),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x331b90,_0x58340b)=>{const _0x1094ee=new DataTransfer();_0x1094ee['setData']('text/html',_0x58340b['html']);const _0x2be3a7=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x47bdab=>{this['_importMarker']['stopListening'](),_0x47bdab['setSelection'](_0x2be3a7),_0x299cec['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x1094ee});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x8794cb,_0xf4fb54={}){if(this['isBusy'])return Promise['resolve']();const _0x550f38=this['editor']['config']['get']('importWord');if(this['editor']['plugins']['has']('MergeFields')){const {prefix:_0x4346d2,suffix:_0x3c6df2}=this['editor']['config']['get']('mergeFields');_0xf4fb54['merge_fields']={'prefix':_0x4346d2,'suffix':_0x3c6df2};}const _0x3ec4cc={'url':_0x550f38['converterUrl'],'file':_0x8794cb,'serviceConfig':{..._0xf4fb54,'formatting':_0x550f38['formatting'],'timezone':new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x3ec4cc)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x4f7f28=this['editor']['model'],_0x8a41ee=_0x4f7f28['schema'],_0x31a0a4=_0x4f7f28['document']['selection'],_0x47ce7c=_0x5570ff(_0x31a0a4['getSelectedBlocks']());return!!_0x47ce7c&&_0x8a41ee['checkChild'](_0x47ce7c['parent'],'paragraph');}['_prepareForImport'](){const _0x545701=this['editor'],_0x5a9a60=_0x545701['model'],_0x5a5b52=_0x5a9a60['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x545701['model']['createBatch']({'isUndoable':!0x0}),_0x5a9a60['enqueueChange'](this['_undoStepBatch'],_0x37b002=>{_0x5a5b52['isCollapsed']||_0x5a9a60['deleteContent'](_0x5a5b52,{'leaveUnmerged':!0x0});const _0x45027a=_0x5a5b52['getFirstPosition'](),_0x4783cd=_0x5570ff(_0x5a5b52['getSelectedBlocks']());let _0x393709;_0x393709=_0x4783cd['is']('element','paragraph')&&_0x4783cd['isEmpty']?_0x45027a:_0x45027a['isAtStart']?_0x5a9a60['createPositionBefore'](_0x4783cd):_0x45027a['isAtEnd']?_0x5a9a60['createPositionAfter'](_0x4783cd):_0x37b002['split'](_0x45027a)['position'],this['_importMarker']=_0x37b002['addMarker']('importWord:'+_0x2ca18a(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x59e7f9(_0x393709)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x1661ce=this['editor']['model'];_0x1661ce['markers']['has'](this['_importMarker'])&&_0x1661ce['enqueueChange'](this['_undoStepBatch'],_0x2f2d2b=>{_0x2f2d2b['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x2e24ce,file:_0x194499,serviceConfig:_0xc93bf5}){const _0x4ea64c=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x41caa8=new FormData();_0x41caa8['set']('config',JSON['stringify'](_0xc93bf5)),_0x41caa8['set']('file',_0x194499);const _0x137bb5={'method':'POST','headers':{},'body':_0x41caa8,'signal':this['_abortController']['signal']};return _0x4ea64c&&(_0x137bb5['headers']['Authorization']=_0x4ea64c['value']),fetch(_0x2e24ce,_0x137bb5);}['_handleImportResponse'](_0x39878e){return _0x39878e['ok']?_0x39878e['json']()['then'](_0x411cfc=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x411cfc);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x49ae8b('import-word-plugin-import-cancelled');const _0x16fcd4=this['editor'],_0x59d8e3=p(_0x16fcd4['locale'],'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x16fcd4['plugins']['get']('Notification')['showWarning'](_0x59d8e3),_0x23bea8('import-word-plugin-conversion-failed');}}class e extends _0x39ba62{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[_0x1a30a4,_0x352614,'CloudServices'];}constructor(_0x5ee873){super(_0x5ee873),this['_token']=null;}async['init'](){const _0x172c28=this['editor'];_0x172c28['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x172c28['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x172c28['commands']['add']('importWord',new d(_0x172c28));const {tokenUrl:_0xb38c98}=_0x172c28['config']['get']('importWord');if(_0xb38c98){const {tokenUrl:_0x4abdad}=_0x172c28['config']['get']('cloudServices')||{};this['_token']=_0xb38c98===_0x4abdad?_0x172c28['plugins']['get']('CloudServices')['token']:await _0x172c28['plugins']['get']('CloudServices')['registerTokenUrl'](_0xb38c98);}}['getToken'](){return this['_token'];}}class o extends _0x39ba62{static get['pluginName'](){return'ImportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[e,i];}}export{o as ImportWord,e as ImportWordEditing,i as ImportWordUI};