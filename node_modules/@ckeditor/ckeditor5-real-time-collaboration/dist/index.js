/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0x2b8ee9,Plugin as _0x3cb587,PendingActions as _0x1b40c8,Context as _0x200362}from'@ckeditor/ckeditor5-core/dist/index.js';import{DomEmitterMixin as _0x5850b9,CKEditorError as _0x5cf78e,Collection as _0x15fdb5,global as _0x2b65ef,version as nt,uid as _0xed2698,KeystrokeHandler as _0x3cfef2}from'@ckeditor/ckeditor5-utils/dist/index.js';import{Notification as _0x7ec224,View as _0x1ec4e8,ListView as _0x252df,ListItemView as et,LabelView as ot,BalloonPanelView as _0x4797f4,clickOutsideHandler as _0x54d39b,BodyCollection as _0x5b1fbd}from'@ckeditor/ckeditor5-ui/dist/index.js';import{LiveRange as at,History as _0x4f8b44,NoOperation as _0x30d268,InsertOperation as _0x129f73,MarkerOperation as _0x3817e5,RootAttributeOperation as _0x706758,transformSets as _0x331848,OperationFactory as _0x4b7ac0}from'@ckeditor/ckeditor5-engine/dist/index.js';import{WebSocketGateway as ht,WEB_SOCKET_GATEWAY_STATES as _0x57405a,CollaborativeEditingService as _0x6f83bd,User as lt,CommentsService as _0x137f3f,TrackChangesService as st,RevisionHistoryService as _0x4d6709,EditorService as _0x48174f}from'@ckeditor/ckeditor-cloud-services-collaboration/dist/index.js';import{Users as _0x6b6ce4,UserView as rt}from'ckeditor5-collaboration/dist/index.js';import{Compressor as _0x1d9279}from'@ckeditor/ckeditor5-operations-compressor/dist/index.js';import{isElement as _0x455fe4}from'lodash-es';class c extends _0x2b8ee9{static ['WebSocketGateway']=/* #__PURE__ -- @preserve */
((()=>ht)());static ['initialReconnectionInterval']=0x3e8;['connection'];['_reconnectionStack'];['_shouldPluginsReconnect'];['_domEmitter'];static get['requires'](){return['CloudServices',_0x7ec224];}static get['pluginName'](){return'WebSocketGateway';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x3de2e5){super(_0x3de2e5),this['set']('state',_0x57405a['CONNECTED']),this['set']('_isBrowserOffline',!0x1),this['_reconnectionStack']=new Set(),this['_shouldPluginsReconnect']=!0x1,this['_domEmitter']=Object['create'](_0x5850b9);}['init'](){const _0x383fbe=this['context'],_0x39fb79=_0x383fbe['plugins']['get']('CloudServices'),_0x185c44=_0x383fbe['plugins']['get'](_0x7ec224);if(!_0x39fb79['token'])throw new _0x5cf78e('websocketgateway-missing-token',this);if(!_0x39fb79['webSocketUrl'])throw new _0x5cf78e('websocketgateway-missing-websocket-url',this);return this['_domEmitter']['listenTo'](window,'offline',()=>this['_isBrowserOffline']=!0x0),this['_domEmitter']['listenTo'](window,'online',()=>this['_isBrowserOffline']=!0x1),this['context']['config']['define']('cloudServices.connectionTimeout',0xa),this['context']['config']['define']('cloudServices.requestTimeout',0x14),c['WebSocketGateway']['connect'](_0x39fb79['token'],_0x39fb79['webSocketUrl'],{'timeout':0x3e8*this['context']['config']['get']('cloudServices.connectionTimeout'),'requestTimeout':0x3e8*this['context']['config']['get']('cloudServices.requestTimeout')})['then'](_0x39b18d=>{if(this['connection']=_0x39b18d,this['bind']('state')['to'](_0x39b18d,'state',this,'_isBrowserOffline',(_0x5ef6a3,_0x4c3f58)=>('connected'!==_0x5ef6a3&&(this['_shouldPluginsReconnect']=!0x0),_0x4c3f58||_0x5ef6a3!==_0x57405a['CONNECTED']?_0x57405a['DISCONNECTED']:this['state']==_0x57405a['DISCONNECTED']&&this['_shouldPluginsReconnect']?(this['_shouldPluginsReconnect']=!0x1,this['_reconnect'](),_0x57405a['CONNECTING']):_0x57405a['CONNECTED'])),this['connection']['on']('error',(_0x43a909,_0x35e5c6)=>{if('limitExceeded'!==_0x35e5c6['code'])throw console['error'](_0x35e5c6),new _0x5cf78e('cloudservices-init',null,{'originalError':_0x35e5c6});_0x185c44['showWarning']('The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.',{'title':'Connected\x20users\x20limit\x20exceeded','namespace':'real-time-collaboration'});}),!_0x39b18d['me'])return new Promise(_0x13c46d=>_0x39b18d['on']('change:me',_0x13c46d));})['catch'](_0x34440e=>{throw console['error'](_0x34440e),new _0x5cf78e('cloudservices-init',null,{'originalError':_0x34440e});});}['addToReconnectionStack'](_0x4a92f7){if('function'!=typeof _0x4a92f7['reconnect'])throw new _0x5cf78e('websocketgateway-invalid-plugin-interface',this);if(this['isInReconnectionStack'](_0x4a92f7))throw new _0x5cf78e('websocketgateway-plugin-already-registered',this,{'name':_0x4a92f7['constructor']['pluginName']});this['_reconnectionStack']['add'](_0x4a92f7);}['removeFromReconnectionStack'](_0x307769){this['_reconnectionStack']['delete'](_0x307769);}['isInReconnectionStack'](_0x25a4c9){return this['_reconnectionStack']['has'](_0x25a4c9);}['_reconnect'](){return this['connection']['reconnect']()['then'](()=>Promise['all'](Array['from'](this['_reconnectionStack'],_0x31d1f7=>_0x31d1f7['reconnect']())))['then'](()=>this['state']=_0x57405a['CONNECTED'])['catch'](_0x19ff86=>{throw console['error'](_0x19ff86),new _0x5cf78e('cloudservices-reconnection-error',this['context']);});}['destroy'](){this['connection']&&this['connection']['disconnect'](),this['state']=_0x57405a['DISCONNECTED'],this['_domEmitter']['stopListening'](),super['destroy']();}}class i extends _0x2b8ee9{['channelSessions'];['channelConnectedUsers'];['allConnectedUsers'];['_registeredSessions'];['_uniqueUsersCount'];['_users'];static get['pluginName'](){return'Sessions';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[c,_0x6b6ce4];}constructor(_0x498ed7){super(_0x498ed7),this['channelSessions']=new Map(),this['channelConnectedUsers']=new Map(),this['allConnectedUsers']=new _0x15fdb5(),this['_registeredSessions']=new Map(),this['_uniqueUsersCount']=0x0,this['_users']=this['context']['plugins']['get'](_0x6b6ce4);}['init'](){const _0x4505db=this['context']['plugins']['get'](c);this['listenTo'](_0x4505db,'change:state',(_0x2e9eb0,_0x3a7457,_0x552db3)=>{if('connected'!==_0x552db3)this['channelSessions']['forEach'](_0x11d426=>_0x11d426['clear']()),this['channelConnectedUsers']['forEach'](_0xd3528d=>_0xd3528d['clear']()),this['allConnectedUsers']['clear']();else{for(const [_0x1b2007,_0x57af04]of this['_registeredSessions'])for(const _0x2bbdbb of _0x57af04)this['_handleSessionAdd'](_0x1b2007,_0x2bbdbb);}}),this['_createUser'](_0x4505db['connection']['me'],!0x0);}['register'](_0x46d180,_0x3da4f0){if(this['_registeredSessions']['has'](_0x46d180))throw new _0x5cf78e('sessions-register-already-registered',null,{'channelId':_0x46d180});this['_registeredSessions']['set'](_0x46d180,_0x3da4f0),this['channelSessions']['set'](_0x46d180,new _0x15fdb5()),this['channelConnectedUsers']['set'](_0x46d180,new _0x15fdb5()),this['listenTo'](_0x3da4f0,'add',(_0x2916b3,_0x3c1fed)=>this['_handleSessionAdd'](_0x46d180,_0x3c1fed)),this['listenTo'](_0x3da4f0,'remove',(_0x19741c,_0x2d5d15)=>this['_handleSessionRemove'](_0x46d180,_0x2d5d15));for(const _0xdc7569 of _0x3da4f0)this['_handleSessionAdd'](_0x46d180,_0xdc7569);}['unregister'](_0x47d3a3){if(!this['_registeredSessions']['has'](_0x47d3a3))throw new _0x5cf78e('sessions-unregister-not-exist',null,{'channelId':_0x47d3a3});const _0x2ad897=this['_registeredSessions']['get'](_0x47d3a3);this['stopListening'](_0x2ad897);for(const _0x26b954 of _0x2ad897)'connected'===this['context']['plugins']['get'](c)['state']&&this['_handleSessionRemove'](_0x47d3a3,_0x26b954);this['_registeredSessions']['delete'](_0x47d3a3),this['channelSessions']['delete'](_0x47d3a3),this['channelConnectedUsers']['delete'](_0x47d3a3);}get['mySessionId'](){return this['context']['plugins']['get'](c)['connection']['sessionId'];}['getUserBySessionId'](_0xb72b0){for(const _0x48e21e of this['channelSessions']['values']())for(const _0x47243d of _0x48e21e)if(_0x47243d['id']===_0xb72b0)return _0x47243d['user'];}['getUserSessions'](_0x163486,_0x44438){const _0x425349=_0x44438?[this['channelSessions']['get'](_0x44438)]:this['channelSessions']['values'](),_0xbccb67=new Set();for(const _0x7826c2 of _0x425349)for(const _0x5008d2 of _0x7826c2)_0x5008d2['user']['id']===_0x163486['id']&&_0xbccb67['add'](_0x5008d2['id']);return _0xbccb67;}['getUserRole'](_0x52c4fb){for(const _0xd9624d of this['channelSessions']['values']())for(const _0x3e4fc2 of _0xd9624d)if(_0x3e4fc2['user']===_0x52c4fb)return _0x3e4fc2['role'];}['_handleSessionAdd'](_0x215a72,_0x14c56f){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x476385=_0x14c56f['user'],_0x58c191=this['_users']['getUser'](_0x476385['id'])||this['_createUser'](_0x476385),_0x675dca=Object['assign']({},_0x14c56f,{'user':_0x58c191});this['channelSessions']['get'](_0x215a72)['add'](_0x675dca);const _0x264ff4=this['channelConnectedUsers']['get'](_0x215a72);_0x264ff4['has'](_0x58c191['id'])||_0x264ff4['add'](_0x58c191),this['allConnectedUsers']['has'](_0x58c191['id'])||this['allConnectedUsers']['add'](_0x58c191,_0x58c191['isMe']?0x0:void 0x0),this['fire']('sessionAdd:'+_0x215a72,{'channelId':_0x215a72,'session':_0x675dca});}['_handleSessionRemove'](_0x10819a,_0x495f7e){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x387d75=this['channelConnectedUsers']['get'](_0x10819a),_0x5934c3=_0x495f7e['user'];_0x5934c3['id']&&(this['channelSessions']['get'](_0x10819a)['remove'](_0x495f7e['id']),_0x387d75['has'](_0x5934c3['id'])&&!this['getUserSessions'](_0x5934c3,_0x10819a)['size']&&_0x387d75['remove'](_0x5934c3['id']),this['allConnectedUsers']['get'](_0x5934c3['id'])&&!this['getUserSessions'](_0x5934c3)['size']&&this['allConnectedUsers']['remove'](_0x5934c3['id']));}['_createUser'](_0x59b414,_0x2f526){const _0x1326fc=this['_users']['addUser'](_0x59b414);return _0x2f526&&this['_users']['defineMe'](_0x59b414['id']),_0x1326fc['orderNumber']=this['_uniqueUsersCount']++,_0x1326fc;}}class K extends _0x3cb587{['_domEmitter']=new(_0x5850b9())();static get['requires'](){return[i];}static get['pluginName'](){return'UserMarkers';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x18039a=this['editor'],_0x16e33f=_0x18039a['plugins']['get'](i);_0x18039a['conversion']['for']('editingDowncast')['markerToElement']({'model':'user:position','view':(_0x2ff075,{writer:_0x1b3fed})=>function(_0xe66010,_0x28c096,_0x995ff0,_0x569635){const _0x428752=_0xe66010['markerName']['split'](':')[0x2],_0x37d97c=_0x995ff0['getUserBySessionId'](_0x428752);if(!_0x37d97c||_0x428752===_0x995ff0['mySessionId'])return;if(!_0x569635['model']['schema']['checkChild'](_0xe66010['markerRange']['start'],'$text'))return;const _0x52f886={'class':'ck-user__marker\x20'+_0x37d97c['color']['getMarkerClass'](),'data-name':_0x37d97c['name'],'data-session-id':_0x428752},_0x1a5001=_0x569635['model']['markers']['get'](_0xe66010['markerName']),_0x55d0ce=_0x1a5001['getStart'](),_0x571b0f=_0x55d0ce['nodeAfter'],_0x480e4c=_0x569635['model']['schema'];if(_0x571b0f&&_0x480e4c['isObject'](_0x571b0f)&&_0x480e4c['isInline'](_0x571b0f)&&!_0x569635['model']['markers']['get']('user:range:'+_0x428752)['getRange']()['isCollapsed'])return;const _0x502132=_0x55d0ce['parent'];return _0x569635['model']['schema']['isLimit'](_0x502132)&&!_0x569635['model']['hasContent'](_0x502132)&&(_0x52f886['contenteditable']=!0x1),function(_0x1d66ac,_0x533e97,_0x30c9c7){const _0x2c5e53=_0x1d66ac['createUIElement']('span',_0x533e97);return _0x1d66ac['setCustomProperty']('userPositionMarker',!0x0,_0x2c5e53),_0x2c5e53['render']=function(_0x22607c){const _0x2168d7=this['toDomElement'](_0x22607c);return _0x2168d7['innerHTML']='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span><span\x20class=\x22ck-user__marker-tooltip\x22\x20contenteditable=\x22false\x22\x20spellcheck=\x22false\x22>'+_0x30c9c7['name']+'</span>⁠',_0x2168d7['addEventListener']('mouseenter',()=>{_0x2168d7['classList']['add']('ck-user__marker_hovered');}),_0x2168d7['addEventListener']('mouseleave',()=>{_0x2168d7['classList']['remove']('ck-user__marker_hovered');}),_0x2168d7;},_0x2c5e53['isSimilar']=function(_0x53f042){return!(!this['getCustomProperty']('userPositionMarker')||!_0x53f042['getCustomProperty']('userPositionMarker')||this['getAttribute']('data-session-id')!=_0x53f042['getAttribute']('data-session-id'));},_0x2c5e53;}(_0x28c096,_0x52f886,_0x37d97c);}(_0x2ff075,_0x1b3fed,_0x16e33f,_0x18039a)}),_0x18039a['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'user:range','view':_0x1a9d45=>function(_0x248d1c,_0x27aca3){const _0x468a29=_0x248d1c['markerName']['split'](':')[0x2];if(_0x468a29===_0x27aca3['mySessionId'])return null;const _0x2f5c79=_0x27aca3['getUserBySessionId'](_0x468a29);if(!_0x2f5c79)return{'id':_0x468a29,'classes':[]};return{'id':_0x468a29,'classes':['ck-user__selection',_0x2f5c79['color']['getSelectionClass']()],'attributes':{'data-session-id':_0x468a29},'priority':0x7d0+_0x2f5c79['orderNumber']};}(_0x1a9d45,_0x16e33f)}),function(_0x43f538){const _0x3c0637=_0x43f538['model'],_0x3711ed=new Map(),_0x3b98f0=_0x43f538['plugins']['get'](i);_0x3c0637['markers']['on']('update:user:range',(_0x785ffe,_0x6db1fb,_0x5aa173,_0x594b02)=>{if(!_0x594b02&&_0x3711ed['get'](_0x6db1fb['name']))return _0x3711ed['get'](_0x6db1fb['name'])['detach'](),void _0x3711ed['delete'](_0x6db1fb['name']);const _0x1325eb=_0x6db1fb['name']['split'](':')[0x2];if(_0x1325eb===_0x3b98f0['mySessionId'])return;const _0x49bbec='user:position:'+_0x1325eb;_0x3c0637['markers']['has'](_0x49bbec)&&_0x43f538['editing']['reconvertMarker'](_0x49bbec),_0x6db1fb['on']('change:range',(_0x44b8d2,_0x11616a,_0x510d04)=>{if('$graveyard'!=_0x11616a['root']['rootName']&&'$graveyard'==_0x6db1fb['getRange']()['root']['rootName']&&!_0x3711ed['has'](_0x6db1fb['name'])){const _0x14d3fb=_0x3c0637['schema']['getNearestSelectionRange'](_0x510d04['deletionPosition']);if(_0x14d3fb){const _0x10a46e=at['fromRange'](_0x14d3fb);_0x3711ed['set'](_0x6db1fb['name'],_0x10a46e),_0x10a46e['on']('change:range',(_0x23d6ee,_0x367471,_0x58c914)=>{if('$graveyard'==_0x10a46e['root']['rootName']){const _0xefff57=_0x3c0637['schema']['getNearestSelectionRange'](_0x58c914['deletionPosition']);_0xefff57?(_0x10a46e['start']=_0xefff57['start'],_0x10a46e['end']=_0xefff57['end']):(_0x3711ed['delete'](_0x6db1fb['name']),_0x10a46e['detach']());}});}}});}),_0x3c0637['document']['on']('change',()=>{_0x3711ed['size']>0x0&&_0x3c0637['enqueueChange']({'isUndoable':!0x1},_0x243f7b=>{for(const [_0x37bdad,_0x56f0c0]of _0x3711ed)'$graveyard'==_0x3c0637['markers']['get'](_0x37bdad)['getRange']()['root']['rootName']&&(te(_0x37bdad['split'](':')[0x2],_0x56f0c0['toRange'](),_0x3c0637,_0x243f7b),_0x56f0c0['detach']());_0x3711ed['clear']();});});}(_0x18039a),this['_domEmitter']['listenTo'](_0x2b65ef['document'],'keydown',(_0xeba6cf,{key:_0x39b520})=>{'Escape'===_0x39b520&&function(_0x5f317a){_0x5f317a['editing']['view']['change'](_0xbd4532=>{for(const _0x4801c0 of _0x5f317a['model']['markers']){if(!_0x4801c0['name']['startsWith']('user:position'))continue;const _0x14e949=_0x5f317a['editing']['mapper']['markerNameToElements'](_0x4801c0['name']);if(_0x14e949){for(const _0x1127bc of _0x14e949)_0xbd4532['removeClass']('ck-user__marker_hovered',_0x1127bc);}}});}(_0x18039a);},{'useCapture':!0x0});}['afterInit'](){const _0x2ff53a=this['editor'],_0x379db3=_0x2ff53a['commands']['get']('undo');_0x379db3&&_0x2ff53a['model']['on']('applyOperation',(_0xdec23a,_0x221e88)=>{const _0x1c237b=_0x221e88[0x0];if('marker'!=_0x1c237b['type']||!_0x1c237b['name']['startsWith']('user:'))return;const _0x42cf1e=_0x1c237b['batch'];_0x379db3['_createdBatches']['has'](_0x42cf1e)&&(_0x1c237b['newRange']=_0x1c237b['oldRange']?_0x2ff53a['model']['createRange'](_0x1c237b['oldRange']['start'],_0x1c237b['oldRange']['end']):null);},{'priority':'highest'});}['destroy'](){return this['_domEmitter']['stopListening'](),super['destroy']();}['createUserMarkerOperations'](){const _0x487199=this['editor'],_0x5f4630=_0x487199['model']['document'],_0x7b78d=_0x487199['plugins']['get'](i);_0x487199['model']['enqueueChange']({'isUndoable':!0x1},_0x1978e0=>{const _0x1a81ac='user:range:'+_0x7b78d['mySessionId'],_0x3db953='user:position:'+_0x7b78d['mySessionId'],_0x1014b8=_0x487199['model']['markers']['has'](_0x1a81ac);_0x487199['editing']['view']['hasDomSelection']?te(_0x7b78d['mySessionId'],_0x5f4630['selection']['getFirstRange'](),_0x487199['model'],_0x1978e0):_0x1014b8&&(_0x1978e0['removeMarker'](_0x1a81ac),_0x1978e0['removeMarker'](_0x3db953));});}}function te(_0x1154a1,_0x3ace7f,_0x5e485f,_0x2f8eed){const _0x290ee0='user:range:'+_0x1154a1,_0x4addca='user:position:'+_0x1154a1,_0x1e91fd=_0x3ace7f['getContainedElement']();let _0x53d525=_0x3ace7f['start'];_0x1e91fd&&_0x1e91fd['is']('element','tableCell')&&(_0x53d525=function(_0x453e27,_0xc20127){for(const _0x1a51b9 of _0x453e27['getPositions']())if(_0xc20127['schema']['checkChild'](_0x1a51b9,'$text'))return _0x1a51b9;}(_0x3ace7f,_0x5e485f),_0x3ace7f=_0x2f8eed['createRange'](_0x53d525));const _0x5a132a=_0x2f8eed['createRange'](_0x53d525);_0x5e485f['markers']['has'](_0x290ee0)?(_0x2f8eed['updateMarker'](_0x290ee0,{'range':_0x3ace7f}),_0x2f8eed['updateMarker'](_0x4addca,{'range':_0x5a132a})):(_0x2f8eed['addMarker'](_0x290ee0,{'range':_0x3ace7f,'usingOperation':!0x0}),_0x2f8eed['addMarker'](_0x4addca,{'range':_0x5a132a,'usingOperation':!0x0}));}function J(_0x49ec3d,_0x2d7be3,_0x4dc351){const _0x40ca98=_0x49ec3d['t'],t=_0x49ec3d['t'];switch(_0x2d7be3){case'PENDING_ACTION_SENDING_DATA':return t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'});case'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'Synchronization\x20issue':return t('Synchronization\x20issue');case'Connected\x20users\x20list\x20dropdown\x20menu':return t('Connected\x20users\x20list\x20dropdown\x20menu');case'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':return t('Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)');case'Connected\x20users\x20list':return t('Connected\x20users\x20list');case'PENDING_ACTION_REVISION_HISTORY':return _0x40ca98({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'});case'CONNECTED_USERS':return t({'string':'1\x20connected\x20user\x20(me)','plural':'%0\x20connected\x20users','id':'CONNECTED_USERS'},_0x4dc351);default:return'';}}let Y=0x1;class l extends _0x3cb587{static ['CollaborativeEditingService']=/* #__PURE__ -- @preserve */
((()=>_0x6f83bd)());['_offset'];['sessionId'];['serverHistory'];['_channelId'];['_service'];['_document'];['_compressor'];['_bufferedOperations'];['_knownOperations'];['_knownRootNames'];['_pendingAction'];['_hasSelectionChanged'];['_sendBufferedOperationsDelayId'];['_baseBufferDelay'];['_currentBufferDelay'];['_lastSyncedOperationId'];['_disconnectionOperations'];['_operationIdentifier'];static get['requires'](){return[c,i,K,_0x1b40c8,_0x6b6ce4,_0x7ec224];}static get['pluginName'](){return'RealTimeCollaborationClient';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){return this['serverHistory']['version']-this['_offset'];}get['lastSyncVersion'](){const _0x904864=this['serverHistory']['getOperations']();for(let _0x3ae7d7=_0x904864['length']-0x1;_0x3ae7d7>=0x0;_0x3ae7d7--){const _0xb78ba1=_0x904864[_0x3ae7d7];if(!this['_disconnectionOperations']['has'](_0xb78ba1))return _0xb78ba1['baseVersion']+0x1-this['_offset'];}return 0x0;}constructor(_0x32a702){if(super(_0x32a702),this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0x4f8b44(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=this['editor']['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x5cf78e('collaboration-missing-channelid',this);const _0x28c365=_0x32a702['config']['get']('cloudServices.bundleVersion')||nt;this['_service']=new l['CollaborativeEditingService'](_0x28c365,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0x1d9279(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['_knownRootNames']=new Set(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new it(this['_disconnectionOperations']);}['init'](){const _0x2b5670=this['editor'],_0x3dc734=_0x2b5670['plugins']['get'](_0x6b6ce4),_0x598bc7=_0x2b5670['plugins']['get'](c);this['listenTo'](_0x3dc734,'getOperationAuthor',(_0x2f1603,_0x20c4fa)=>{const _0x3dde56=_0x20c4fa[0x0];_0x3dde56['_authorId']&&(_0x2f1603['return']=_0x3dc734['getUser'](_0x3dde56['_authorId']),_0x2f1603['stop']()),null===_0x3dde56['_authorId']&&(_0x2f1603['return']=null,_0x2f1603['stop']());},{'priority':'high'}),this['listenTo'](_0x2b5670['model']['document']['selection'],'change:range',(_0x37d680,_0x138059)=>{_0x138059['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x2b5670['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x2b5670['model']['on']('applyOperation',(_0x2d7f6b,_0x155244)=>{const _0x154e71=_0x155244[0x0];_0x154e71['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x154e71),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x598bc7,'state',this,'_hasSynchronizationProblem',(_0x1e8990,_0x538b02)=>'connected'===_0x1e8990&&!_0x538b02),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x2b5670['disableReadOnlyMode']('rtc-offline'):_0x2b5670['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x2b5670['disableReadOnlyMode']('rtc-offline'):_0x2b5670['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x495d5e=this['editor']['plugins']['get'](i),_0x167bda=this['editor']['plugins']['get'](c);try{this['_isPendingUpdate']=!0x0,_0x495d5e['unregister'](this['_channelId']);const _0x3cdb00=await this['_service']['reconnect'](_0x167bda['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x3cdb00)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x4cc4dc=await this['_service']['getConnectedSessions']();_0x495d5e['register'](this['_channelId'],_0x4cc4dc),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x3ede67){if(function(_0x281084){return'404'===_0x281084['code'];}(_0x3ede67)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0xa5d7be){return'409'===_0xa5d7be['code'];}(_0x3ede67)){const _0xcc1132=J(this['editor']['locale'],'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0xcc1132);}else{if(!(_0x3ede67 instanceof Z))throw _0x3ede67;this['_handleReconnectionError']();}}}}['destroy'](){const _0x479cc2=this['editor']['plugins']['get'](c),_0x1df614=this['editor']['plugins']['get'](i);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x1df614['channelSessions']['has'](this['_channelId'])&&_0x1df614['unregister'](this['_channelId']),_0x479cc2['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x1b489f){if(this['sessionId']!==_0x1b489f['sessionId']&&this['_lastSyncedOperationId']!==_0x1b489f['lastOperationId'])throw new Z();return this['sessionId']=_0x1b489f['sessionId'],this['_handleServerResponse']([],{..._0x1b489f,'wereChangesApplied':!0x1,'data':_0x1b489f['data']},'reconnect');}async['_connectService'](_0x34abd9,_0x46c19b=!0x1){const {connection:_0x1e1d47}=this['editor']['plugins']['get'](c);l['CollaborativeEditingService']['getConnectedSessions'](_0x1e1d47,this['_channelId'])['then'](_0x4c95cd=>this['_initSessionsHandling'](_0x4c95cd))['catch'](_0x197a4f=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x197a4f);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0x453ed2,_0x599a65)=>{this['_crash']('realtimecollaborationclient-initservice-internal-error',_0x599a65);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x443f86=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x34abd9);this['_isPendingUpdate']=!0x0;const _0x2717e1=await this['_service']['connect'](_0x1e1d47,this['_compressOperations'](_0x34abd9),_0x443f86);if(this['sessionId']=_0x2717e1['sessionId'],_0x46c19b){if(!_0x2717e1['wereChangesApplied'])return void this['_handleReconnectionError']();this['_isPendingUpdate']=!0x1,this['_clearPendingAction'](),this['serverHistory']['reset'](),this['_offset']=_0x2717e1['offset'],this['serverHistory']['version']=this['_offset'],await this['_handleServerResponse'](_0x34abd9,_0x2717e1,'reconnection:\x20flushed\x20session');}else await this['_handleInitialConnectionData'](_0x2717e1,_0x34abd9);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x47211f=this['editor']['plugins']['get'](i),_0x21bd48=this['editor']['plugins']['get'](K),_0x4124c1=_0x47211f['channelSessions']['get'](this['_channelId']);_0x4124c1&&_0x4124c1['length']>0x1?_0x21bd48['createUserMarkerOperations']():this['listenTo'](_0x47211f,'sessionAdd:'+this['_channelId'],()=>{0x2===_0x47211f['channelSessions']['get'](this['_channelId'])['length']&&_0x21bd48['createUserMarkerOperations']();});}async['_handleReceivedOperations'](_0x5428f3,_0x317929,_0x44ebbe,_0x339f73){if(!this['_isPendingUpdate']&&this['_document']['version']==_0x317929){const _0x4425f1=this['_decompressOperations'](_0x44ebbe,_0x339f73);await this['_fetchMissingUsers'](_0x4425f1),this['_handleExternalOperations'](_0x4425f1,_0x317929,_0x44ebbe['lastOperationId'])||this['_crash']('realtimecollaborationclient-initservice-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const {locale:_0x3c4d38}=this['editor'];let _0x19f012;try{_0x19f012=await this['_service']['getDocumentDetails']();}catch(_0xbf3869){const _0x3bc255=J(_0x3c4d38,'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x3bc255);}const _0x14f808=_0x19f012['currentDocumentSession']||_0x19f012['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x14f808['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x3bfae8=J(_0x3c4d38,'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x3bfae8);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelayId']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x18a21a){const _0x2ff531=this['editor']['plugins']['get'](i);this['listenTo'](_0x2ff531,'sessionAdd:'+this['_channelId'],(_0x36e5e4,{session:_0x5b7b81})=>{if(_0x5b7b81['id']===_0x2ff531['mySessionId']){_0x36e5e4['off']();const _0x16bea6=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x16e5b3=_0x5b7b81['permissions'];_0x16bea6&&_0x16bea6['isEnabled']&&(_0x16e5b3=_0x16e5b3['filter'](_0x18ae40=>'document:write'!==_0x18ae40)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x16e5b3,this['_channelId']);}}),_0x2ff531['register'](this['_channelId'],_0x18a21a);}['_initThrowingOnDataSet'](){const _0x524291=this['editor']['data']['set'];this['editor']['data']['set']=(..._0x3e2cf0)=>{if(!_0x3e2cf0[_0x3e2cf0['length']-0x1]['suppressErrorInCollaboration'])throw new _0x5cf78e('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x524291['apply'](this['editor']['data'],_0x3e2cf0);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x2008d4,[_0x4b716b])=>{if(this['_document']['version'])throw new _0x5cf78e('realtimecollaborationclient-init-document-already-initialized',this);_0x2008d4['stop'](),this['_setPendingAction']();const _0x590f42=this['editor']['config']['get']('rootsAttributes'),_0x4ecc93=this['_getOperationsFromInitData'](_0x4b716b,_0x590f42);0x0==_0x4ecc93['length']&&_0x4ecc93['push'](new _0x30d268(0x0)),_0x2008d4['return']=this['_connectService'](_0x4ecc93)['then'](()=>{this['editor']['plugins']['get'](c)['addToReconnectionStack'](this),this['editor']['data']['fire']('ready');})['catch'](_0x34fb41=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0x34fb41))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'}),this['editor']['on']('loadRoot',async(_0x3231b0,[_0x1b13db,_0x11f846])=>{_0x3231b0['stop']();const _0x2e969e=this['editor']['model']['document']['getRoot'](_0x1b13db);if(!this['_knownRootNames']['has'](_0x1b13db)){const _0x2046aa=_0x11f846&&_0x11f846['data']?_0x11f846['data']:'',_0x480908=_0x11f846&&_0x11f846['attributes']?_0x11f846['attributes']:{};await this['_loadRoot'](_0x1b13db,_0x2046aa,_0x480908);}this['editor']['model']['enqueueChange']({'isUndoable':!0x1},()=>{_0x2e969e['_isLoaded']=!0x0,this['editor']['model']['document']['differ']['_bufferRootLoad'](_0x2e969e);});},{'priority':'high'});}async['_fetchMissingUsers'](_0x5bd8dc){const _0x5389f7=this['editor']['plugins']['get'](_0x6b6ce4),{connection:_0x16124b}=this['editor']['plugins']['get'](c),_0x32cb93=new Set();for(const _0x4ab0bc of _0x5bd8dc){const _0x1dca73=_0x4ab0bc['_authorId'];_0x1dca73&&!_0x5389f7['getUser'](_0x1dca73)&&_0x32cb93['add'](_0x1dca73);}if(0x0===_0x32cb93['size'])return;const _0xf07290=await lt['getMany'](_0x16124b,Array['from'](_0x32cb93));for(const _0x4ae79e of _0xf07290)_0x5389f7['getUser'](_0x4ae79e['id'])||_0x5389f7['addUser'](_0x4ae79e);}['_getOperationsFromInitData'](_0x181933,_0x1140a3={}){const _0x32cea4=this['editor']['model'],_0x477325=[];let _0x22428f=0x0;const _0x10063f='string'==typeof _0x181933?{'main':_0x181933}:_0x181933;for(const _0xae477d of Object['keys'](_0x10063f)){if(!this['_document']['roots']['has'](_0xae477d))throw new _0x5cf78e('realtimecollaborationclient-init-non-existent-root',this);const _0x23ef7a=this['editor']['data']['parse'](_0x10063f[_0xae477d]),_0x333719=this['_document']['getRoot'](_0xae477d),_0x11edb9=new _0x129f73(_0x32cea4['createPositionAt'](_0x333719,0x0),_0x23ef7a,_0x22428f++);_0x477325['push'](_0x11edb9);for(const [_0x67ccbb,_0x1c2018]of _0x23ef7a['markers']){const _0x36ec19=_0x32cea4['createRange'](_0x32cea4['createPositionFromPath'](_0x333719,_0x1c2018['start']['path']['slice']()),_0x32cea4['createPositionFromPath'](_0x333719,_0x1c2018['end']['path']['slice']())),_0x1e4df8=new _0x3817e5(_0x67ccbb,null,_0x36ec19,_0x32cea4['markers'],!0x0,_0x22428f++);_0x477325['push'](_0x1e4df8);}}if(_0x1140a3)for(const [_0x1ffc56,_0x5da6f3]of Object['entries'](_0x1140a3)){const _0x2f4151=_0x32cea4['document']['getRoot'](_0x1ffc56);if(!_0x2f4151)throw new _0x5cf78e('multi-root-editor-root-attributes-no-root',null);for(const [_0x4e5d58,_0x201d8e]of Object['entries'](_0x5da6f3))if(null!==_0x201d8e){const _0x5b62fb=new _0x706758(_0x2f4151,_0x4e5d58,null,_0x201d8e,_0x22428f++);_0x477325['push'](_0x5b62fb);}}return _0x477325;}async['_loadRoot'](_0x58b5fc,_0x2ca0e5,_0x1b8401){this['_getOperationsFromInitData']({[_0x58b5fc]:_0x2ca0e5},{[_0x58b5fc]:_0x1b8401})['forEach']((_0x21d5e8,_0x328b07)=>{_0x21d5e8['baseVersion']=this['_document']['version']+_0x328b07,_0x21d5e8['_isInit']=!0x0,this['_saveOperationInBuffer'](_0x21d5e8);}),this['_sendBufferedOperationsDelayed'](),await this['_waitUntilSynced']();}async['_handleInitialConnectionData'](_0x5324a5,_0x42a115){let _0xb63bdd;this['_offset']=_0x5324a5['offset'];const _0x4c74ef=_0x5324a5['wereChangesApplied']&&!_0x5324a5['initData'],_0x3b0ef3=_0x4c74ef?0x0:_0x5324a5['data']['baseVersion'];if(_0x42a115['forEach'](_0x3ba279=>{_0x3ba279['_isInit']=!0x0,_0x3ba279['createdAt']=_0x5324a5['sessionCreatedAt'],_0x3ba279['_authorId']=null;}),_0x4c74ef)_0xb63bdd=_0x42a115,this['_applyOperationsSet'](_0xb63bdd,_0x4c74ef);else{if(_0x5324a5['initData']){const _0x11a473=this['_getOperationsFromInitData'](_0x5324a5['initData']);this['_document']['history']['version']=-_0x11a473['length'],_0x11a473['forEach'](_0x20b5bc=>{_0x20b5bc['baseVersion']-=_0x11a473['length'],_0x20b5bc['createdAt']=_0x5324a5['sessionCreatedAt'],_0x20b5bc['_isInit']=!0x0,_0x20b5bc['_authorId']=null;}),this['_applyOperationsSet'](_0x11a473,!0x0),this['serverHistory']['version']=-_0x11a473['length']+this['_offset'],this['_updateServerHistory'](_0x11a473);}this['_document']['history']['version']=_0x3b0ef3,_0xb63bdd=this['_decompressOperations'](_0x5324a5['data'],_0x5324a5['metadata']),await this['_fetchMissingUsers'](_0xb63bdd),this['_applyOperationsSet'](_0xb63bdd,_0x4c74ef);}_0x5324a5['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0xb63bdd,_0x5324a5['lastOperationId']),this['_lastSyncedOperationId']=_0x5324a5['lastOperationId']),this['serverHistory']['version']=_0x3b0ef3+this['_offset'],this['_updateServerHistory'](_0xb63bdd),_0x42a115['filter'](_0x4ad072=>{const _0x2de7e8=this['_getAffectedRoot'](_0x4ad072);return _0x2de7e8&&!this['_knownRootNames']['has'](_0x2de7e8);})['forEach']((_0x40d009,_0x35f8fc)=>{_0x40d009['baseVersion']=this['_document']['version']+_0x35f8fc,this['_saveOperationInBuffer'](_0x40d009);}),this['_shouldSendUpdate']()?(this['_currentBufferDelay']=0x0,this['_sendBufferedOperationsDelayed'](!0x0),await this['_waitUntilSynced']()):(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());}['_crash'](_0x5f3b67,_0x4be97e){throw this['_isPendingUpdate']=!0x0,_0x4be97e&&console['error'](_0x4be97e),new _0x5cf78e(_0x5f3b67,this['editor']);}['_saveOperationInBuffer'](_0x17e20f){this['_knownOperations']['has'](_0x17e20f)||(this['_knownOperations']['add'](_0x17e20f),this['_bufferedOperations']['push'](_0x17e20f),this['_pendingAction']||'marker'==_0x17e20f['type']&&!_0x17e20f['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x1faf60=!0x1){!_0x1faf60&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x440083=>{_0x440083&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0x5ff357=>{if(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,!function(_0x17c315){return _0x17c315['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x17c315['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0x17c315['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x5ff357))throw _0x5ff357;});},this['_currentBufferDelay']));}['_waitUntilSynced'](){return new Promise(_0x592db6=>{this['on']('change:_isPendingUpdate',()=>{_0x592db6();});});}async['_sendBufferedOperations'](){const _0x33a926=this['editor']['plugins']['get'](K);if(this['_shouldSendSelectionUpdate']()&&(_0x33a926['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x103098=[...this['_bufferedOperations']];for(const _0x4a1358 of _0x103098)_0x4a1358['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x4a1358);const _0x182bba=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x103098),_0x1263ae=Y++,_0x522d9e=this['_compressOperations'](_0x103098),_0x4699fa=await this['_service']['sendOperations'](_0x522d9e,_0x522d9e['baseVersion'],_0x182bba);try{return await this['_handleServerResponse'](_0x103098,_0x4699fa,_0x1263ae);}catch(_0x34659b){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x34659b);}}async['_handleServerResponse'](_0x37978f,_0xf2e4dc,_0x4fc21e){if('error'in _0xf2e4dc)throw _0xf2e4dc['error'];let _0xf2a631=!0x1;if(_0xf2e4dc['wereChangesApplied']){_0xf2e4dc['lastOperationId']&&(this['_lastSyncedOperationId']=_0xf2e4dc['lastOperationId']),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x4e01c1=>!_0x37978f['includes'](_0x4e01c1));for(const _0x40cd00 of _0x37978f)_0x40cd00['createdAt']='lastOperationAcceptedAt'in _0xf2e4dc&&_0xf2e4dc['lastOperationAcceptedAt']||void 0x0;tt(_0x37978f,_0xf2e4dc['version']-_0x37978f['length']),this['_updateServerHistory'](_0x37978f);const _0x4ccf5d=_0x37978f['filter'](_0x6c66e3=>{if(!_0x6c66e3['_isInit'])return!0x1;const _0x586290=this['_getAffectedRoot'](_0x6c66e3);return _0x586290&&!this['_knownRootNames']['has'](_0x586290);});tt(_0x4ccf5d,this['_document']['version']),this['_applyOperationsSet'](_0x4ccf5d),_0xf2a631=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x29a5a2=this['_decompressOperations'](_0xf2e4dc['data'],_0xf2e4dc['metadata'])['filter'](_0x59c42a=>_0x59c42a['baseVersion']>=this['_lastServerVersion']);_0x29a5a2['forEach'](_0x33b33f=>this['_addKnownRoot'](_0x33b33f)),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x312acd=>!_0x312acd['_isInit']||!this['_knownRootNames']['has'](this['_getAffectedRoot'](_0x312acd))),this['_bufferedOperations']['length']&&tt(this['_bufferedOperations'],this['_bufferedOperations'][0x0]['baseVersion']),await this['_fetchMissingUsers'](_0x29a5a2),_0xf2a631=this['_handleExternalOperations'](_0x29a5a2,_0xf2e4dc['version'],_0xf2e4dc['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0xf2a631?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x58b8e2,_0x2079cd,_0xd83b99){try{const _0x177e42={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x15cba7,operationsB:_0x342e14,originalOperations:_0x5ea339}=_0x331848(_0x58b8e2,this['_bufferedOperations'],_0x177e42);tt(_0x15cba7,this['_document']['version']),tt(_0x342e14,_0x2079cd);for(const _0x25af09 of _0x15cba7){const _0x18a3da=_0x5ea339['get'](_0x25af09);_0x25af09['_authorId']=_0x18a3da?_0x18a3da['_authorId']:null;}_0xd83b99&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x58b8e2,_0xd83b99),this['_lastSyncedOperationId']=_0xd83b99),this['_bufferedOperations']=[..._0x342e14],this['_applyOperationsSet'](_0x15cba7),this['_updateServerHistory'](_0x58b8e2);}catch(_0x362e03){return console['error'](_0x362e03),!0x1;}return!0x0;}['_applyOperationsSet'](_0xd412e7,_0x1c8c3=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0x145824=>{for(const _0x559eb0 of _0xd412e7)this['_knownOperations']['add'](_0x559eb0),this['_addKnownRoot'](_0x559eb0),_0x145824['batch']['addOperation'](_0x559eb0),this['editor']['model']['applyOperation'](_0x559eb0);});}['_addKnownRoot'](_0x5b24e8){const _0x190a3c=this['_getAffectedRoot'](_0x5b24e8);_0x190a3c&&this['_knownRootNames']['add'](_0x190a3c);}['_getAffectedRoot'](_0x1b15f7){let _0x21e844,_0x10b8d0;switch(_0x1b15f7['type']){case'insert':_0x21e844=_0x1b15f7['position']['root'];break;case'marker':if(_0x10b8d0=_0x1b15f7['newRange'],!_0x10b8d0)return null;_0x21e844=_0x10b8d0['root'];break;case'addRootAttribute':_0x21e844=_0x1b15f7['root'];break;case'addRoot':_0x21e844=_0x1b15f7['affectedSelectable'];break;case'move':_0x21e844=_0x1b15f7['targetPosition']['root'];break;default:return null;}return _0x21e844['rootName'];}['_updateServerHistory'](_0x9e941d){_0x9e941d['forEach'](_0x3372cb=>{const _0x1ef7a2=_0x3372cb['clone']();_0x1ef7a2['_authorId']=_0x3372cb['_authorId'],_0x1ef7a2['_isInit']=!!_0x3372cb['_isInit'],_0x1ef7a2['createdAt']=_0x3372cb['createdAt'],_0x1ef7a2['baseVersion']+=this['_offset'],_0x3372cb['_isDisconnection']&&this['_disconnectionOperations']['add'](_0x1ef7a2),this['serverHistory']['addOperation'](_0x1ef7a2);});}['_handleReconnectionError'](_0x272556){const _0x3865e1=this['editor']['plugins']['get']('Notification'),_0x55972c=this['editor']['locale'];_0x272556||(_0x272556=J(_0x55972c,'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x3865e1['showWarning'](_0x272556,{'title':J(_0x55972c,'Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](c)['destroy']();}['_setPendingAction'](){this['_pendingAction']||(this['_pendingAction']=this['editor']['plugins']['get'](_0x1b40c8)['add'](J(this['editor']['locale'],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0x1b40c8)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x43aa0e){const _0x1284bb=_0x43aa0e['map'](_0x1eabea=>_0x1eabea['toJSON']());return this['_compressor']['compress'](_0x1284bb);}['_decompressOperations'](_0xb1f0a0,_0x53a5c8){return this['_compressor']['decompress'](_0xb1f0a0)['map']((_0x122ff4,_0x4d6308)=>{const _0x34afc9='init'==_0x53a5c8[_0x4d6308]['type'];if('InsertOperation'==_0x122ff4['__className']){const _0x246112=_0x122ff4['position']['root'];!this['_document']['getRoot'](_0x246112)&&(this['_document']['createRoot']('$root',_0x246112)['_isAttached']=!0x1);}const _0x504642=_0x4b7ac0['fromJSON'](_0x122ff4,this['_document']);return _0x504642['wasUndone']=_0x122ff4['wasUndone'],_0x504642['_isInit']=_0x34afc9,_0x504642['_authorId']=_0x34afc9?null:_0x53a5c8[_0x4d6308]['userId'],_0x504642['_isDisconnection']='cs:removeUser'===_0x53a5c8[_0x4d6308]['type'],_0x504642['createdAt']=_0x53a5c8[_0x4d6308]['createdAt'],_0x504642;});}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()?this['_sendBufferedOperationsDelayed']():this['_hasSelectionChanged']=!0x1;}['_shouldSendSelectionUpdate'](){const _0x30c9d8=this['editor']['plugins']['get'](i)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&!!_0x30c9d8&&_0x30c9d8['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class Z extends Error{}function tt(_0x3e2399,_0x38ae7c){for(const _0x4bff68 of _0x3e2399)_0x4bff68['baseVersion']=_0x38ae7c++;}class it{['_ignoredOperations'];['_operationToId'];constructor(_0x206f7b){this['_ignoredOperations']=_0x206f7b,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x3945ce){let _0x4afb29=_0x3945ce['length'];for(;_0x4afb29--;){const _0x3b47e0=_0x3945ce[_0x4afb29];if(!this['_ignoredOperations']['has'](_0x3b47e0)){if(!this['_operationToId']['has'](_0x3b47e0)){const _0x5b5c20=_0xed2698()['slice'](0x1,0x12);this['_operationToId']['set'](_0x3b47e0,_0x5b5c20);}return this['_operationToId']['get'](_0x3b47e0);}}}['setIdForTheLastOperation'](_0x74b52a,_0x2bf160){if(!_0x2bf160)return;let _0x586392=_0x74b52a['length'];for(;_0x586392--;){const _0x50e40d=_0x74b52a[_0x586392];this['_ignoredOperations']['has'](_0x50e40d)||this['_operationToId']['set'](_0x50e40d,_0x2bf160);}}}class n extends _0x3cb587{static get['requires'](){return[l];}static get['pluginName'](){return'RealTimeCollaborativeEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class a extends _0x2b8ee9{static ['CommentsService']=/* #__PURE__ -- @preserve */
((()=>_0x137f3f)());['_services'];static get['requires'](){return[c,'CommentsRepository',i,_0x6b6ce4];}static get['pluginName'](){return'CloudServicesCommentsAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x5bdb88){super(_0x5bdb88),this['_services']=new Map();}async['init'](){const _0x484903=this['context'],_0x4cd917=_0x484903['plugins']['get']('CommentsRepository');if(_0x484903['plugins']['get'](c)['addToReconnectionStack'](this),_0x4cd917['adapter']={'addCommentThread':async({channelId:_0x14beb4,threadId:_0x4a7858,comments:_0xbd4abb,resolvedAt:_0xf29a6b,resolvedBy:_0x1108d2,context:_0xeefe42,attributes:_0x3281a9})=>{const _0xaf6bfc=await this['_getService'](_0x14beb4)['addCommentThread']({'commentThreadId':_0x4a7858,'comments':_0xbd4abb['map'](_0x16b2a7=>function(_0x1df5ef,_0x734c7e,_0x7ef17){return{'commentThreadId':_0x7ef17,'commentId':_0x1df5ef['commentId'],'userId':_0x1df5ef['authorId'],'content':_0x1df5ef['content'],'documentId':_0x734c7e,'createdAt':_0x1df5ef['createdAt'],'attributes':_0x1df5ef['attributes']||{}};}(_0x16b2a7,_0x14beb4,_0x4a7858)),'resolvedAt':_0xf29a6b,'resolvedBy':_0x1108d2,'context':_0xeefe42,'attributes':_0x3281a9})['catch'](dt);return{'threadId':_0xaf6bfc['commentThreadId'],'comments':_0xaf6bfc['comments']};},'getCommentThread':async({channelId:_0x434773,threadId:_0xb1ae72})=>{const _0xbc5377=await this['_getService'](_0x434773)['getCommentThread'](_0xb1ae72)['catch'](dt);return _0xbc5377['deletedAt']?null:(await this['_fetchMissingUsersForThreads']([_0xbc5377]),{'threadId':_0xbc5377['commentThreadId'],'comments':_0xbc5377['comments']['map'](S),'context':_0xbc5377['context'],'resolvedAt':_0xbc5377['resolvedAt'],'resolvedBy':_0xbc5377['resolvedBy'],'attributes':_0xbc5377['attributes']||{}});},'updateCommentThread':async({channelId:_0x37f696,threadId:_0x44e3d8,context:_0x43b144,unlinkedAt:_0x54f79a,attributes:_0x1a0fd0})=>this['_getService'](_0x37f696)['updateCommentThread']({'commentThreadId':_0x44e3d8,'context':_0x43b144,'attributes':_0x1a0fd0,'unlinkedAt':_0x54f79a})['catch'](B)['catch'](dt),'resolveCommentThread':async({channelId:_0x224475,threadId:_0xedeb09})=>{const _0x25c962=await this['_getService'](_0x224475)['resolveCommentThread'](_0xedeb09)['catch'](B)['catch'](dt);return{'threadId':_0x25c962['commentThreadId'],'resolvedAt':_0x25c962['resolvedAt'],'resolvedBy':_0x25c962['resolvedBy']};},'reopenCommentThread':async({channelId:_0x5aad81,threadId:_0xc12dcc})=>this['_getService'](_0x5aad81)['reopenCommentThread'](_0xc12dcc)['catch'](B)['catch'](dt),'removeCommentThread':({channelId:_0x24b1c4,threadId:_0xf219ca})=>this['_getService'](_0x24b1c4)['removeCommentThread'](_0xf219ca)['catch'](B)['catch'](dt),'addComment':({channelId:_0x3ad2cc,threadId:_0x3e8a35,commentId:_0x564cce,content:_0x22d822,attributes:_0x16c68f})=>this['_getService'](_0x3ad2cc)['addComment'](_0x3e8a35,_0x564cce,_0x22d822,_0x16c68f)['catch'](dt),'updateComment':({channelId:_0x49bf69,threadId:_0x3dc68f,commentId:_0x5bb144,content:_0x4e0c72,attributes:_0x20aa8e})=>this['_getService'](_0x49bf69)['updateComment'](_0x3dc68f,_0x5bb144,_0x4e0c72,_0x20aa8e)['catch'](B)['catch'](dt),'removeComment':({channelId:_0x1fdea1,threadId:_0x4da426,commentId:_0x2d07ce})=>this['_getService'](_0x1fdea1)['removeComment'](_0x4da426,_0x2d07ce)['catch'](B)['catch'](dt)},_0x484903 instanceof _0x200362){const _0xfe0d9f=_0x484903['config']['get']('collaboration.channelId'),_0x4b7c25=_0x484903['plugins']['get'](i);await this['_setUpService'](_0xfe0d9f);const _0x2a0669=await this['_services']['get'](_0xfe0d9f)['getConnectedSessions']();this['listenTo'](_0x4b7c25,'sessionAdd:'+_0xfe0d9f,(_0x401216,{session:_0xf8f5d4})=>{_0xf8f5d4['id']===_0x4b7c25['mySessionId']&&(_0x401216['off'](),this['context']['plugins']['get']('Permissions')['setPermissions'](_0xf8f5d4['permissions'],_0xfe0d9f));}),_0x4b7c25['register'](_0xfe0d9f,_0x2a0669);}}async['_setUpService'](_0x39c75c){if(this['_services']['has'](_0x39c75c))throw new _0x5cf78e('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x39c75c});const _0x331582=this['context']['plugins']['get']('CommentsRepository'),_0x3cb996=new a['CommentsService'](_0x39c75c);this['_services']['set'](_0x39c75c,_0x3cb996),this['listenTo'](_0x3cb996,'commentThreadAdded',(_0x3202e3,_0x3a252a)=>{const {commentThreadId:_0x29420c,documentId:_0x2eeb33,context:_0x5dd754,attributes:_0x4ec832,resolvedAt:_0x5c24f0,resolvedBy:_0x31419b,comments:_0x5d3736}=_0x3a252a;_0x331582['getCommentThread'](_0x29420c)||_0x331582['addCommentThread']({'threadId':_0x29420c,'channelId':_0x2eeb33,'comments':_0x5d3736?_0x5d3736['map'](S):[],'context':_0x5dd754,'attributes':_0x4ec832,'resolvedAt':_0x5c24f0,'resolvedBy':_0x31419b,'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentThreadUpdated',(_0x3ad48a,{commentThreadId:_0x49d7f5,documentId:_0x5239c6,context:_0xe13c7,unlinkedAt:_0x5445dc,attributes:_0x23175b})=>{_0x331582['getCommentThread'](_0x49d7f5)&&_0x331582['updateCommentThread']({'threadId':_0x49d7f5,'channelId':_0x5239c6,'context':_0xe13c7,'unlinkedAt':_0x5445dc,'attributes':_0x23175b,'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentThreadResolved',(_0x543ccf,{commentThreadId:_0x1cb156,resolvedBy:_0x4f9017,resolvedAt:_0x1c9de1})=>{const _0x548e27=_0x331582['getCommentThread'](_0x1cb156);_0x548e27&&_0x548e27['resolve']({'resolvedBy':_0x4f9017,'resolvedAt':_0x1c9de1,'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentThreadReopened',(_0x46c3c3,{commentThreadId:_0x34c98f})=>{const _0x4d04f0=_0x331582['getCommentThread'](_0x34c98f);_0x4d04f0&&_0x4d04f0['reopen']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentThreadRemoved',(_0x4dd792,{commentThreadId:_0x19c7db})=>{const _0x58154d=_0x331582['getCommentThread'](_0x19c7db);_0x58154d&&_0x58154d['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentAdded',(_0x211711,_0x24f350)=>{const _0x99f80a=_0x24f350['commentThreadId'],_0x527e0c=_0x331582['getCommentThread'](_0x99f80a);_0x527e0c&&_0x527e0c['addComment']({...S(_0x24f350),'isFromAdapter':!0x0});}),this['listenTo'](_0x3cb996,'commentUpdated',(_0x223b2f,{commentThreadId:_0x3448ae,commentId:_0x268932,content:_0x50777f,attributes:_0x4d907f})=>{const _0x445b87=_0x331582['getCommentThread'](_0x3448ae);if(_0x445b87){const _0x5a0ace=_0x445b87['getComment'](_0x268932);_0x5a0ace&&_0x5a0ace['update']({'content':_0x50777f,'attributes':_0x4d907f,'isFromAdapter':!0x0});}}),this['listenTo'](_0x3cb996,'commentRemoved',(_0x145a0f,{commentThreadId:_0x162929,commentId:_0x2ea5be})=>{const _0x343729=_0x331582['getCommentThread'](_0x162929);if(_0x343729){const _0x2fe019=_0x343729['getComment'](_0x2ea5be);_0x2fe019&&_0x2fe019['remove']({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x39c75c);}['destroy'](){if(this['context']instanceof _0x200362){const _0x4a71d5=this['context']['config']['get']('collaboration.channelId');this['_terminateService'](_0x4a71d5);}}['_terminateService'](_0x184def){if(!this['_services']['has'](_0x184def))throw new _0x5cf78e('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x184def});this['_getService'](_0x184def)['disconnect'](),this['_services']['delete'](_0x184def);}async['reconnect'](){for(const _0x4018e1 of this['_services']['keys']())await this['_connectService'](_0x4018e1);if(this['context']instanceof _0x200362){const _0x1e5c1e=this['context']['config']['get']('collaboration.channelId'),_0x4510db=this['context']['plugins']['get'](i);_0x4510db['unregister'](_0x1e5c1e);const _0x115cb9=await this['_services']['get'](_0x1e5c1e)['getConnectedSessions']();_0x4510db['register'](_0x1e5c1e,_0x115cb9);}}async['_connectService'](_0x2224f9){const {connection:_0x5a3ede}=this['context']['plugins']['get'](c),_0x28398e=this['context']['plugins']['get']('CommentsRepository'),_0x59b4b1=this['_services']['get'](_0x2224f9),_0x162590=await _0x59b4b1['connect'](_0x5a3ede);await this['_fetchMissingUsersForThreads'](_0x162590);const _0x5d4e84=new Set(Array['from'](_0x28398e['getCommentThreads']({'channelId':_0x2224f9}),_0x1002ad=>_0x1002ad['id']));for(const _0x14a4d2 of _0x162590)_0x14a4d2['deletedAt']||_0x5d4e84['delete'](_0x14a4d2['commentThreadId']);for(const _0x17fb25 of _0x5d4e84)_0x28398e['getCommentThread'](_0x17fb25)['remove']({'isFromAdapter':!0x0});for(const _0x2d7a0e of _0x162590){let _0x464aa6=_0x28398e['getCommentThread'](_0x2d7a0e['commentThreadId']);const {commentThreadId:_0x25872d,context:_0x4dadbe,attributes:_0x732026,resolvedBy:_0xb9e967,resolvedAt:_0x56bef9,unlinkedAt:_0x7e5e3e,deletedAt:_0x5ce576}=_0x2d7a0e;if(_0x5ce576)continue;_0x464aa6||(_0x464aa6=_0x28398e['addCommentThread']({'channelId':_0x2224f9,'threadId':_0x25872d,'context':_0x4dadbe,'attributes':_0x732026||{},'resolvedBy':_0xb9e967,'resolvedAt':_0x56bef9,'unlinkedAt':_0x7e5e3e,'isFromAdapter':!0x0}));const _0x13e61d=new Set(Array['from'](_0x464aa6['comments'],_0x328175=>_0x328175['id']));for(const _0x4f96b1 of _0x2d7a0e['comments'])_0x13e61d['delete'](_0x4f96b1['commentId']);for(const _0x352463 of _0x13e61d)_0x464aa6['getComment'](_0x352463)['remove']({'isFromAdapter':!0x0});for(const _0x33e136 of _0x2d7a0e['comments']){const _0x257e33=_0x464aa6['getComment'](_0x33e136['commentId']);_0x257e33?_0x257e33['content']!==_0x33e136['content']&&_0x257e33['update']({'content':_0x33e136['content'],'isFromAdapter':!0x0}):_0x464aa6['addComment'](Object['assign'](S(_0x33e136),{'isFromAdapter':!0x0}));}}}['_getService'](_0x35acaf){if(!this['_services']['has'](_0x35acaf))throw new _0x5cf78e('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x35acaf});return this['_services']['get'](_0x35acaf);}async['_fetchMissingUsersForThreads'](_0x137845){const _0x1b7345=this['context']['plugins']['get'](_0x6b6ce4),{connection:_0x242082}=this['context']['plugins']['get'](c),_0x5a8415=new Set();for(const {resolvedBy:_0x3df208,comments:_0x15c2a0}of _0x137845){_0x3df208&&!_0x1b7345['getUser'](_0x3df208)&&_0x5a8415['add'](_0x3df208);for(const {userId:_0x41f220}of _0x15c2a0)_0x1b7345['getUser'](_0x41f220)||_0x5a8415['add'](_0x41f220);}if(0x0===_0x5a8415['size'])return;const _0x3f1832=await lt['getMany'](_0x242082,Array['from'](_0x5a8415));for(const _0x4300bd of _0x3f1832)_0x1b7345['getUser'](_0x4300bd['id'])||_0x1b7345['addUser'](_0x4300bd);}}async function B(_0x332a19){if('404'!==_0x332a19['code'])throw _0x332a19;}function dt(_0x5407db){if((_0x1b1860=_0x5407db)['message']['startsWith']('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x1b1860['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x1b1860['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x1b1860;throw _0x5407db;}function S(_0x3aeeb7){return{'threadId':_0x3aeeb7['commentThreadId'],'commentId':_0x3aeeb7['commentId'],'content':_0x3aeeb7['content'],'createdAt':_0x3aeeb7['createdAt'],'authorId':_0x3aeeb7['userId'],'attributes':_0x3aeeb7['attributes']||{}};}class f extends _0x3cb587{static ['TrackChangesService']=/* #__PURE__ -- @preserve */
((()=>st)());['_bufferedRequests'];['_trackChangesService'];static get['requires'](){return[a,'TrackChangesEditing',c];}constructor(_0x1ae424){super(_0x1ae424);const _0x42f19a=this['editor']['config']['get']('collaboration.channelId');this['_bufferedRequests']=new Map(),this['_trackChangesService']=new f['TrackChangesService'](_0x42f19a);}['init'](){const _0x1f7bd5=this['editor']['plugins']['get'](c),_0x1cebc9=this['editor']['plugins']['get']('TrackChangesEditing');return _0x1cebc9['adapter']={'getSuggestion':async _0x5c3054=>{await this['_waitForServiceReady']();const _0x4950c1=await this['_trackChangesService']['get'](_0x5c3054)['catch'](R);return await this['_fetchMissingUsersForThreads']([_0x4950c1]),_0x4950c1;},'addSuggestion':async({id:_0x23ca64,type:_0x4a33aa,data:_0x549d88,originalSuggestionId:_0x551cdd,attributes:_0x49c752})=>{await this['_waitForServiceReady']();const _0x17b660={'id':_0x23ca64,'type':_0x4a33aa,'data':_0x549d88,'originalSuggestionId':_0x551cdd,'attributes':_0x49c752},_0xb3979f=await this['_trackChangesService']['add'](_0x23ca64,_0x4a33aa,_0x549d88,_0x551cdd,_0x49c752)['catch'](_0x506022=>{if(ut(_0x506022))return new Promise(_0x5a421c=>{this['_bufferedRequests']['set'](_0x23ca64,{'resolve':_0x5a421c,'suggestionData':_0x17b660});});throw _0x506022;});return this['_bufferedRequests']['delete'](_0x23ca64),_0xb3979f;},'updateSuggestion':async(_0x370372,_0x404bc1)=>{if(await this['_waitForServiceReady'](),'open'!==_0x404bc1['state'])return this['_trackChangesService']['update'](_0x370372,_0x404bc1)['catch'](R);}},this['listenTo'](this['_trackChangesService'],'suggestionUpdated',(_0x2da477,_0x21accd)=>{_0x1cebc9['hasSuggestion'](_0x21accd['id'])&&(_0x1cebc9['getSuggestion'](_0x21accd['id'])['attributes']=_0x21accd['attributes']);}),this['_trackChangesService']['connect'](_0x1f7bd5['connection'])['then'](_0x54868d=>(_0x1f7bd5['addToReconnectionStack'](this),this['_fetchMissingUsersForThreads'](_0x54868d)['then'](()=>{for(const _0x353aa8 of _0x54868d){_0x1cebc9['addSuggestionData'](_0x353aa8)['_saved']=!0x0;}})));}async['reconnect'](){const _0x26dfd7=this['editor']['plugins']['get']('TrackChangesEditing'),{connection:_0x5f38eb}=this['editor']['plugins']['get'](c),_0x16e2e4=await this['_trackChangesService']['connect'](_0x5f38eb);await this['_fetchMissingUsersForThreads'](_0x16e2e4);for(const {suggestionData:_0x56dcdb,resolve:_0x384eb2}of this['_bufferedRequests']['values']()){let _0x39a207=_0x16e2e4['find'](_0x59dba3=>_0x59dba3['id']===_0x56dcdb['id']);_0x39a207||(_0x39a207=await this['_trackChangesService']['add'](_0x56dcdb['id'],_0x56dcdb['type'],_0x56dcdb['data'],_0x56dcdb['originalSuggestionId'])),_0x384eb2(_0x39a207);}for(const _0x3bf079 of _0x16e2e4)_0x26dfd7['hasSuggestion'](_0x3bf079['id'])||_0x26dfd7['addSuggestionData'](_0x3bf079);}async['_waitForServiceReady'](){this['_trackChangesService']['isConnected']||await new Promise(_0x4aa8b5=>{this['listenTo'](this['_trackChangesService'],'connected',_0xe4d8b9=>{_0xe4d8b9['off'](),_0x4aa8b5();});});}async['_fetchMissingUsersForThreads'](_0x59796d){const _0x2d1db0=this['editor']['plugins']['get'](_0x6b6ce4),{connection:_0x26b032}=this['editor']['plugins']['get'](c),_0x1e2369=new Set();for(const {authorId:_0xac526}of _0x59796d)_0x2d1db0['getUser'](_0xac526)||_0x1e2369['add'](_0xac526);if(0x0===_0x1e2369['size'])return;const _0x5d705c=await lt['getMany'](_0x26b032,Array['from'](_0x1e2369));for(const _0x1944e of _0x5d705c)_0x2d1db0['getUser'](_0x1944e['id'])||_0x2d1db0['addUser'](_0x1944e);}}function R(_0x2ca253){if(ut(_0x2ca253))return new Promise(()=>{});throw _0x2ca253;}function ut(_0x325584){return _0x325584['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x325584['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class m extends _0x3cb587{static get['requires'](){return['Comments',a,n,c];}static get['pluginName'](){return'RealTimeCollaborativeComments';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x2b81fb=this['editor']['plugins']['get'](c),_0x2b513f=this['editor']['plugins']['get']('CommentsEditing'),_0x193a6e=this['editor']['plugins']['get'](a);return this['editor']['data']['once']('ready',()=>{this['listenTo'](_0x2b81fb,'change:state',(_0x3a7c22,_0x37fcd3,_0x48828f)=>{_0x2b513f['isThreadsLoadingPaused']='connected'!==_0x48828f;});}),this['listenTo'](_0x2b81fb,'change:state',(_0x5b6fdf,_0x3d9cf4,_0x232640)=>{this['editor']['plugins']['get']('CommentsRepository')['switchReadOnly']('connected'!==_0x232640);}),_0x193a6e['_setUpService'](this['editor']['config']['get']('collaboration.channelId'));}['destroy'](){this['editor']['plugins']['get'](a)['_terminateService'](this['editor']['config']['get']('collaboration.channelId')),super['destroy']();}}class p extends _0x3cb587{static get['requires'](){return[m,f,'TrackChanges'];}static get['pluginName'](){return'RealTimeCollaborativeTrackChanges';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class u extends _0x3cb587{static ['RevisionHistoryService']=/* #__PURE__ -- @preserve */
((()=>_0x4d6709)());['_lastRequestId'];['_revisionTracker'];['_revisionHistoryService'];['_oldOffset'];static get['requires'](){return[c,l,'RevisionTracker',i,_0x6b6ce4];}constructor(_0x533aea){super(_0x533aea);const _0x468267=this['editor']['config']['get']('collaboration.channelId');this['_lastRequestId']=null,this['_revisionTracker']=this['editor']['plugins']['get']('RevisionTracker'),this['_revisionHistoryService']=new u['RevisionHistoryService'](_0x468267);}async['init'](){const _0x3327be=this['editor']['plugins']['get'](l),_0x499b31=_0x3327be['serverHistory'],_0x4a59c2=this['editor']['plugins']['get'](c);this['_revisionTracker']['setSource']({'history':_0x499b31,'getLatestVersion':()=>this['_getLatestVersion'](),'getCurrentRevisionId':()=>_0x3327be['sessionId']});const _0x1d1eac=this['editor']['config']['get']('cloudServices.bundleVersion')||nt,_0x2a773c=await _0x48174f['isBundleUploaded'](_0x4a59c2['connection'],_0x1d1eac);this['_revisionTracker']['adapter']={'getRevision':async({revisionId:_0x4867f2})=>(await this['_waitForServiceReady'](),await this['_revisionHistoryService']['getRevision'](_0x4867f2)),'updateRevisions':async _0x1ce958=>{await this['_waitForServiceReady']();const _0x1e6c15=this['_revisionTracker']['currentRevision'];if(_0x2a773c&&0x1===_0x1ce958['length']&&_0x1ce958[0x0]['id']===_0x1e6c15['id'])return _0x1ce958;for(const _0x3d824e of _0x1ce958)_0x3d824e['id']===_0x1e6c15['id']&&(_0x3d824e['isEmptyCurrent']=_0x3d824e['fromVersion']===_0x3d824e['toVersion']);return this['_revisionHistoryService']['updateRevisions'](_0x1ce958,this['_lastRequestId'])['then'](_0x1fc3a2=>(this['_lastRequestId']=_0x1fc3a2,_0x1ce958))['catch'](_0x5c9d3c=>{if(P(_0x5c9d3c)||'400'===_0x5c9d3c['code']&&void 0x0!==_0x5c9d3c['data']['wrongRequestId']){for(const _0x3d517d of _0x1ce958){!this['_revisionTracker']['repository']['getRevision'](_0x3d517d['id'])||this['_revisionTracker']['_bufferUpdate'](_0x3d517d['id'],_0x3d517d,!0x1);}if(P(_0x5c9d3c))throw _0x5c9d3c;return _0x1ce958;}throw _0x5c9d3c;});}},this['listenTo'](this['_revisionHistoryService'],'revisionsUpdated',(_0x2d1b0d,{revisionsData:_0x1529c5,requestId:_0x52ecc8})=>{Math['max'](..._0x1529c5['map'](_0x33032e=>_0x33032e['toVersion']))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()['then'](()=>{this['_handleRevisionsUpdate'](_0x1529c5,_0x52ecc8);}):this['_handleRevisionsUpdate'](_0x1529c5,_0x52ecc8);});const {revisions:_0x4f0dac,requestId:_0x1eec74}=await this['_revisionHistoryService']['connect'](_0x4a59c2['connection']);_0x4a59c2['addToReconnectionStack'](this),this['_lastRequestId']=_0x1eec74,await this['_fetchMissingUsers'](_0x4f0dac);for(const _0x3dc54b of _0x4f0dac)this['_revisionTracker']['addRevisionData'](_0x3dc54b);this['listenTo'](_0x3327be,'change:_isConnected',(_0x44c65d,_0x296ad8,_0x4d1486)=>{_0x4d1486&&(this['_oldOffset']=_0x3327be['_offset'],_0x44c65d['off']());}),this['_revisionTracker']['bind']('isEnabled')['to'](_0x4a59c2,'state',_0x16d52d=>_0x16d52d===_0x57405a['CONNECTED']);}async['reconnect'](){const _0x139150=this['editor']['plugins']['get'](c),_0x3979e8=this['editor']['plugins']['get'](l),_0x1158de=async()=>{const _0x44043e=this['_revisionTracker']['currentRevision'],_0xdee82f=_0x44043e['id'],_0x3b19f9=_0xdee82f!==_0x3979e8['sessionId'];if(_0x3b19f9){const _0x5e8370=_0x3979e8['_offset']-this['_oldOffset'],_0x161f70=this['_getLatestVersionFromServerOperations']();this['_revisionTracker']['_revisionDataBuilder']['reInit']();if(_0x44043e['toVersion']+_0x5e8370!==_0x161f70){const _0x501299=_0x44043e['fromVersion']+_0x5e8370,_0x1314ae=this['editor']['plugins']['get'](_0x6b6ce4),_0x25d1c6=this['_revisionTracker']['buildRevisionData']({'revision':_0x44043e,'from':_0x501299,'to':_0x161f70});_0x25d1c6['id']=_0x44043e['id'];const _0x39a086=_0x25d1c6['authorsIds']['map'](_0x227d58=>_0x1314ae['getUser'](_0x227d58));_0x44043e['_update']({..._0x25d1c6,'authors':_0x39a086},!0x0),this['_revisionTracker']['_bufferUpdate'](_0x44043e['id'],_0x25d1c6,!0x0);}this['_revisionTracker']['_startingVersion']=_0x161f70,(_0x44043e['toVersion']===_0x44043e['fromVersion']&&!this['_revisionTracker']['_bufferedUpdates']['has'](_0xdee82f)&&this['_revisionTracker']['repository']['_revisions']['remove'](_0xdee82f),this['_revisionTracker']['_createCurrentRevision'](_0x161f70));}const {revisions:_0xa19ee0,requestId:_0x40f098}=await this['_revisionHistoryService']['reconnect'](_0x139150['connection'],this['_lastRequestId']);_0x3b19f9&&_0xa19ee0['length']>0x0?_0x3979e8['_handleReconnectionError']():(await this['_fetchMissingUsers'](_0xa19ee0),this['_handleRevisionsUpdate'](_0xa19ee0,_0x40f098),this['_revisionTracker']['sendBufferedUpdates']());};return _0x3979e8['_isConnected']?_0x1158de():new Promise((_0x3f2795,_0x5a4d63)=>{_0x3979e8['once']('change:_isConnected',()=>{_0x1158de()['then'](_0x3f2795)['catch'](_0x5a4d63);});});}['destroy'](){super['destroy']();}async['_waitForServiceReady'](){this['_revisionHistoryService']['isConnected']||await new Promise(_0x1d4850=>{this['listenTo'](this['_revisionHistoryService'],'connected',_0x205c12=>{_0x205c12['off'](),_0x1d4850();});});}['_getLatestVersionFromServerOperations'](){const _0x4528b9=this['editor']['plugins']['get'](l)['serverHistory']['getOperations']()['reverse']();for(const _0x324bc7 of _0x4528b9)if('marker'!==_0x324bc7['type']||_0x324bc7['affectsData'])return _0x324bc7['baseVersion']+0x1;}['_getLatestVersion'](){const _0x134021=this['editor']['plugins']['get'](l);return new Promise(_0x9c1e62=>{_0x134021['_isPendingUpdate']?_0x134021['once']('change:_isPendingUpdate',()=>{_0x9c1e62(this['_getLatestVersionFromServerOperations']());}):_0x9c1e62(this['_getLatestVersionFromServerOperations']());});}['_handleRevisionsUpdate'](_0x222223,_0x4ea2e5){const _0x50e666=this['_revisionTracker']['repository'];this['_lastRequestId']=_0x4ea2e5;for(const _0x16d501 of _0x222223){const _0x4ae9e1=_0x50e666['getRevision'](_0x16d501['id']);if(_0x4ae9e1){if((_0x16d501['fromVersion']||_0x16d501['toVersion'])&&(_0x16d501['diffData']=null),_0x4ae9e1===this['_revisionTracker']['currentRevision']){const _0x419af5=Math['max'](_0x4ae9e1['toVersion'],_0x16d501['toVersion']),_0x248209=Math['max'](_0x4ae9e1['fromVersion'],_0x16d501['fromVersion']);let _0x3790d2;_0x4ae9e1['toVersion']===_0x16d501['toVersion']&&_0x4ae9e1['fromVersion']===_0x16d501['fromVersion']?(_0x3790d2=!0x0,this['_preventResendingRevisionData'](_0x16d501)):_0x16d501['toVersion']===_0x419af5&&_0x16d501['fromVersion']===_0x248209?_0x3790d2=!0x1:(_0x4ae9e1['toVersion']===_0x419af5&&_0x4ae9e1['fromVersion']===_0x248209||this['_fixRevision']({'revision':_0x4ae9e1,'from':_0x248209,'to':_0x419af5}),_0x3790d2=!0x0),_0x3790d2&&(delete _0x16d501['fromVersion'],delete _0x16d501['toVersion'],delete _0x16d501['diffData'],delete _0x16d501['createdAt'],delete _0x16d501['authorsIds']);}this['_revisionTracker']['setRevisionData'](_0x16d501),this['_preventResendingRevisionData'](_0x16d501);}else this['_revisionTracker']['addRevisionData'](_0x16d501);}const _0x32d42b=_0x50e666['getRevisions']();_0x32d42b['reverse']();for(let _0xfa6b4=0x0;_0xfa6b4<_0x32d42b['length']-0x1;_0xfa6b4++){const _0xa6ec10=_0x32d42b[_0xfa6b4],_0x28c38a=_0x32d42b[_0xfa6b4+0x1];if(_0xa6ec10['fromVersion']<_0x28c38a['toVersion']){const _0xec8f08=_0x28c38a['toVersion'],_0x5e9159=Math['max'](_0xec8f08,_0xa6ec10['toVersion']);this['_fixRevision']({'revision':_0xa6ec10,'from':_0xec8f08,'to':_0x5e9159});}}}['_fixRevision']({revision:_0x59b3d8,from:_0x2509e8,to:_0x450938}={}){const _0x1fbb7f=this['editor']['plugins']['get'](_0x6b6ce4),_0x384bdf=this['_revisionTracker']['buildRevisionData']({'revision':_0x59b3d8,'from':_0x2509e8,'to':_0x450938});_0x384bdf['authors']=_0x384bdf['authorsIds']['map'](_0x292b21=>_0x1fbb7f['getUser'](_0x292b21)),_0x59b3d8['_update'](_0x384bdf);}['_preventResendingRevisionData'](_0x22a16f){const _0xc52a50={};_0xc52a50['id']=_0x22a16f['id'];for(const _0x2c8b39 of Object['keys'](_0x22a16f))'id'!==_0x2c8b39&&(_0xc52a50[_0x2c8b39]=void 0x0);this['_revisionTracker']['_bufferUpdate'](_0xc52a50['id'],_0xc52a50,!0x0);}async['_fetchMissingUsers'](_0xe70f69){const _0x31699d=this['editor']['plugins']['get'](_0x6b6ce4),{connection:_0x49418a}=this['editor']['plugins']['get'](c),_0x28127e=new Set();for(const _0x201ee1 of _0xe70f69){for(const _0x2893f3 of _0x201ee1['authorsIds'])_0x32c29e(_0x2893f3);_0x201ee1['creatorId']&&_0x32c29e(_0x201ee1['creatorId']);}if(0x0===_0x28127e['size'])return;const _0x2cbd40=await lt['getMany'](_0x49418a,Array['from'](_0x28127e));for(const _0x2bc234 of _0x2cbd40)_0x31699d['getUser'](_0x2bc234['id'])||_0x31699d['addUser'](_0x2bc234);function _0x32c29e(_0xa75e3){_0x31699d['getUser'](_0xa75e3)||_0x28127e['add'](_0xa75e3);}}}function P(_0x148ea8){return _0x148ea8['message']['startsWith']('cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.')||_0x148ea8['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x148ea8['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class g extends _0x3cb587{static get['requires'](){return['RevisionHistory',u,n];}static get['pluginName'](){return'RealTimeCollaborativeRevisionHistory';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class ts extends _0x1ec4e8{constructor(_0x41e35d){super(_0x41e35d);const _0x1fca76=this['bindTemplate'];this['set']('usersCount',0x0),this['set']('isHidden',!0x0),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__counter',_0x1fca76['if']('isHidden','ck-presence-list__counter--hidden')]},'children':[{'text':_0x1fca76['to']('usersCount',_0x58b3df=>J(_0x41e35d,'CONNECTED_USERS',_0x58b3df))}]});}}class es extends _0x1ec4e8{['items'];['keystrokes'];constructor(_0x24be28){super(_0x24be28);const _0x2d93d5=this['bindTemplate'];this['items']=this['createCollection'](),this['keystrokes']=new _0x3cfef2(),this['set']({'hasPopup':!0x1,'isExpanded':!0x1}),this['setTemplate']({'tag':'div','attributes':{'aria-haspopup':_0x2d93d5['if']('hasPopup'),'aria-expanded':_0x2d93d5['to']('isExpanded',_0x21d602=>this['hasPopup']&&String(_0x21d602)),'aria-label':_0x2d93d5['to']('hasPopup',_0x541ca9=>J(_0x24be28,_0x541ca9?'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':'Connected\x20users\x20list')),'role':'list','tabindex':_0x2d93d5['to']('hasPopup',_0x14e75f=>!!_0x14e75f&&0x0),'class':['ck','ck-presence-list__list']},'children':this['items'],'on':{'click':_0x2d93d5['to'](()=>this['fire']('execute'))}}),this['on']('change:hasPopup',(_0x4f5572,_0x56c3f8,_0x3e4ebe)=>{this['element']&&(_0x3e4ebe?this['element']['setAttribute']('aria-expanded',String(this['isExpanded'])):this['element']['removeAttribute']('aria-expanded'));});}['focus'](){this['element']['focus']();}['render'](){super['render'](),this['keystrokes']['listenTo'](this['element']);}}class L extends _0x1ec4e8{['counterView'];['inlineListView'];constructor(_0x1d3aef){super(_0x1d3aef);const _0x4407f8=this['bindTemplate'];this['set']('isCollapsed',!0x0),this['counterView']=new ts(this['locale']),this['inlineListView']=new es(_0x1d3aef),this['inlineListView']['bind']('hasPopup')['to'](this,'isCollapsed'),this['listenTo'](this['inlineListView']['items'],'change',()=>{for(const _0x3ba4c9 of this['inlineListView']['items'])_0x3ba4c9['tooltipPosition']='s';this['inlineListView']['items']['first']&&(this['inlineListView']['items']['first']['tooltipPosition']='se');}),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list','ck-reset','ck-rounded-corners',_0x4407f8['if']('isCollapsed','ck-presence-list--collapsed')]},'children':[this['counterView'],this['inlineListView']]});}}class j extends _0x1ec4e8{['listWrapperView'];constructor(_0x5badeb,_0x4921c0){super(_0x5badeb),this['listWrapperView']=new ft(_0x5badeb,_0x4921c0),this['setTemplate']({'tag':'div','attributes':{'tabindex':-0x1,'role':'application','class':['ck','ck-presence-list__dropdown-list'],'aria-label':J(_0x5badeb,'Connected\x20users\x20list\x20dropdown\x20menu')},'children':[this['listWrapperView']]});}}class ft extends _0x252df{constructor(_0x4a3b2a,_0x590e25){super(_0x4a3b2a);const _0x24c3c5=this['bindTemplate'];this['set']('_isScrollable',!0x1),this['setTemplate']({'tag':_0x590e25?'div':'ul','attributes':{'class':['ck','ck-reset','ck-list','ck-presence-list__dropdown-list-wrapper',_0x24c3c5['if']('_isScrollable','ck-presence-list__dropdown-list-wrapper_scrollable')],'role':_0x24c3c5['to']('role'),'aria-label':_0x24c3c5['to']('ariaLabel'),'aria-labelledby':_0x24c3c5['to']('ariaLabelledBy')},'children':this['items']}),this['listenTo'](_0x2b65ef['window'],'resize',()=>this['checkIfScrollable']()),this['items']['on']('change',()=>this['checkIfScrollable']());}['render'](){super['render'](),this['checkIfScrollable']();}['checkIfScrollable'](){const _0x5908f6=this['element'];_0x5908f6&&(this['_isScrollable']=Math['max'](_0x5908f6['scrollHeight'],_0x5908f6['clientHeight'])>0.8*window['innerHeight']);}}class k extends et{['userView'];constructor(_0x54a643,_0x1dd5b4,_0x405b76){super(_0x54a643);const _0x368938=this['bindTemplate'];this['userView']=new rt(_0x54a643,_0x1dd5b4);const _0x5163c6={'tag':'li','attributes':{'class':['ck','ck-presence-list__dropdown-list-item'],'tabindex':-0x1,'role':'presentation','aria-label':_0x1dd5b4['name']},'children':[this['userView'],{'tag':'span','attributes':{'class':['ck','ck-user__full-name']},'children':[{'text':_0x1dd5b4['name']}]},{'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x1dd5b4['color']['getBackgroundColorClass']()],'aria-hidden':'true'}}]};_0x405b76&&(_0x5163c6['tag']='button',_0x5163c6['on']={'click':_0x368938['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x5163c6);}['focus'](){this['element']['focus']();}}class y extends _0x1ec4e8{['userView'];['markerView'];constructor(_0x4491eb,_0x49c0f5,_0x34bd64){super(_0x4491eb);const _0x2973db=this['bindTemplate'];this['set']('isFocusable',!0x1),this['set']('hasTooltip',!0x0),this['set']('tooltipPosition',''),this['userView']=new rt(_0x4491eb,_0x49c0f5),this['markerView']=new ct(_0x4491eb,_0x49c0f5);const _0x5b4b88=new ot(_0x4491eb);_0x5b4b88['template']['tag']='span',_0x5b4b88['text']=_0x49c0f5['name'];const _0x410782={'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item'],'role':'listitem','tabindex':_0x2973db['to']('isFocusable',_0x9c3f2d=>!!_0x9c3f2d&&0x0),'aria-labelledby':_0x5b4b88['id'],'data-cke-tooltip-text':this['userView']['name'],'data-cke-tooltip-position':_0x2973db['to']('tooltipPosition'),'data-cke-tooltip-disabled':_0x2973db['to']('hasTooltip',_0x23c09e=>!_0x23c09e),'data-cke-tooltip-class':'ck-presence-list__list-item__tooltip'},'children':[this['userView'],this['markerView'],_0x5b4b88]};_0x34bd64&&(_0x410782['tag']='button',_0x410782['on']={'click':_0x2973db['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x410782);}}class ct extends _0x1ec4e8{constructor(_0x1cce5b,_0x3fefcf){super(_0x1cce5b),this['setTemplate']({'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x3fefcf['color']['getBackgroundColorClass']()],'aria-hidden':'true'}});}}const A={'collapseAt':0x6,'displayMe':!0x0};class r extends _0x2b8ee9{['currentDisplayedUsers'];['balloonPanelView'];['view'];['presenceDropdownView'];['_bodyCollection']=null;constructor(_0x53a1d4){super(_0x53a1d4),this['context']['config']['define']('presenceList',A);const _0x129495=_0x53a1d4['config']['get']('presenceList.collapseAt');if('number'!=typeof _0x129495)throw new _0x5cf78e('presencelist-collapseat-invalid-format',this);if(_0x129495<0x1)throw new _0x5cf78e('presencelist-collapseat-invalid-format',this);this['_allConnectedUsers']=this['context']['plugins']['get'](i)['allConnectedUsers'],this['set']('usersCount',0x0),this['currentDisplayedUsers']=new _0x15fdb5(),this['balloonPanelView']=new _0x4797f4(),this['balloonPanelView']['class']='ck\x20ck-presence-list__balloon',this['view']=this['_createView'](),this['presenceDropdownView']=void 0x0;}static get['requires'](){return[i];}['init'](){for(const _0x4f762c of this['_allConnectedUsers'])this['_handleUserAdd'](_0x4f762c);this['listenTo'](this['_allConnectedUsers'],'add',(_0xd44dc2,_0x11af68)=>{this['_handleUserAdd'](_0x11af68);}),this['listenTo'](this['_allConnectedUsers'],'remove',(_0x3631fd,_0x1d0f6b)=>{this['_handleUserRemove'](_0x1d0f6b);});}['_createView'](){const _0x4ae5d8=this['context'],_0xc32ea6=new L(this['context']['locale']),_0x485b41=this['balloonPanelView'];if(!_0x455fe4(_0x4ae5d8['config']['get']('presenceList.container')))throw new _0x5cf78e('presencelist-missing-container',this);return _0xc32ea6['counterView']['bind']('usersCount')['to'](this),_0xc32ea6['bind']('isCollapsed')['to'](this,'usersCount',_0x4bb5b2=>{const {collapseAt:_0x5be581,displayMe:_0x33585d}=_0x4ae5d8['config']['get']('presenceList'),_0x405144=_0x4bb5b2>=_0x5be581;return _0xc32ea6['counterView']['isHidden']=!(0x1==_0x4bb5b2&&_0x33585d||_0x405144),_0x405144||this['hideDropdown'](),_0x405144;}),_0xc32ea6['inlineListView']['items']['bindTo'](this['currentDisplayedUsers'])['using'](_0x575316=>{const _0x150d37=_0x4ae5d8['config']['get']('presenceList'),_0x58284e=new y(_0x4ae5d8['locale'],_0x575316,!!_0x150d37['onClick']);return _0x58284e['bind']('hasTooltip')['to'](_0xc32ea6,'isCollapsed',_0x490f4b=>!_0x490f4b),_0x58284e['bind']('isFocusable')['to'](_0xc32ea6,'isCollapsed',_0x115fc5=>!_0x115fc5),_0x150d37['onClick']&&this['listenTo'](_0x58284e,'execute',()=>{this['view']['isCollapsed']||_0x150d37['onClick'](_0x575316,_0x58284e['element']);}),_0x58284e;}),this['listenTo'](_0xc32ea6['inlineListView'],'execute',()=>{this['presenceDropdownView']?this['hideDropdown']():this['view']['isCollapsed']&&this['showDropdown']();}),_0xc32ea6['inlineListView']['keystrokes']['set']('Enter',(_0x4309fd,_0xbc3229)=>{this['view']['isCollapsed']&&(this['showDropdown'](),_0xbc3229());}),_0xc32ea6['render'](),_0x485b41['render'](),_0x54d39b({'emitter':_0xc32ea6,'activator':()=>_0x485b41['isVisible'],'contextElements':[_0x485b41['element'],_0xc32ea6['inlineListView']['element']],'callback':()=>this['hideDropdown']()}),_0x4ae5d8['config']['get']('presenceList.container')['appendChild'](_0xc32ea6['element']),this['_bodyCollection']=new _0x5b1fbd(this['context']['locale']),this['_bodyCollection']['attachToDom'](),this['_bodyCollection']['add'](this['balloonPanelView']),_0xc32ea6;}['_handleUserAdd'](_0x401b58){if(!this['context']['config']['get']('presenceList.displayMe')&&_0x401b58['isMe'])return;const _0x485742=this['context']['config']['get']('presenceList.collapseAt')-0x1;this['usersCount']++,this['currentDisplayedUsers']['length']==_0x485742&&this['currentDisplayedUsers']['length']>0x1&&this['currentDisplayedUsers']['remove'](0x1);const _0x380e12=_0x401b58['isMe']?0x0:this['currentDisplayedUsers']['length'];this['currentDisplayedUsers']['add'](_0x401b58,_0x380e12);}['_handleUserRemove'](_0x42e6e7){if(this['usersCount']--,this['currentDisplayedUsers']['get'](_0x42e6e7['id'])&&(this['currentDisplayedUsers']['remove'](_0x42e6e7['id']),this['currentDisplayedUsers']['length']<this['usersCount'])){for(const _0x450271 of Array['from'](this['_allConnectedUsers'])['reverse']())if(!this['currentDisplayedUsers']['get'](_0x450271['id']))return void this['currentDisplayedUsers']['add'](_0x450271,Math['min'](this['currentDisplayedUsers']['length'],0x1));}}['showDropdown'](){if(this['presenceDropdownView'])return;const _0x48e3be=this['context']['config']['get']('presenceList');this['presenceDropdownView']=new j(this['context']['locale'],!!_0x48e3be['onClick']),this['view']['inlineListView']['isExpanded']=!0x0;const {listWrapperView:_0x421ed1}=this['presenceDropdownView'];_0x421ed1['items']['bindTo'](this['_allConnectedUsers'])['using'](_0x10d5d8=>{if(!_0x48e3be['displayMe']&&_0x10d5d8['isMe'])return null;const _0x2478a3=new k(this['context']['locale'],_0x10d5d8,!!_0x48e3be['onClick']);return _0x48e3be['onClick']&&this['listenTo'](_0x2478a3,'execute',()=>{_0x48e3be['onClick'](_0x10d5d8,_0x2478a3['element']);}),_0x2478a3;}),this['balloonPanelView']['content']['add'](this['presenceDropdownView']),this['balloonPanelView']['pin']({'target':this['view']['inlineListView']['element']}),_0x421ed1['focus'](),_0x421ed1['checkIfScrollable']();const _0x3aa643=(_0x6e12fa,_0x945de4)=>{this['hideDropdown'](),this['view']['inlineListView']['focus'](),_0x945de4();};_0x421ed1['keystrokes']['set']('Esc',_0x3aa643),_0x421ed1['keystrokes']['set']('Shift+Tab',_0x3aa643),_0x421ed1['keystrokes']['set']('Tab',(_0x2c5dea,_0x24da71)=>{!function(_0x55427d){const _0x314980=['a','button','input','select','textarea','[tabindex]','[contenteditable]']['map'](_0x184659=>_0x184659+':not([disabled]):not([tabindex=\x22-1\x22])')['join'](','),_0x5ba036=[...document['body']['querySelectorAll'](_0x314980)]['filter'](_0x49282b=>_0x49282b===document['activeElement']||_0x49282b['offsetWidth']+_0x49282b['offsetHeight']>0x0)['sort']((_0x346619,_0x550b01)=>(_0x346619['tabIndex']||0x0)-(_0x550b01['tabIndex']||0x0)),_0x2b70e4=_0x5ba036['indexOf'](_0x55427d),_0x310e2b=_0x5ba036[(_0x2b70e4+0x1)%_0x5ba036['length']];_0x310e2b&&_0x310e2b['focus']();}(this['view']['element']),this['hideDropdown'](),_0x24da71();}),_0x421ed1['focusTracker']['add'](this['view']['element']),_0x421ed1['focusTracker']['on']('change:isFocused',(_0x345235,_0x4a897a,_0x25c092)=>{_0x25c092||this['hideDropdown']();});}['hideDropdown'](){this['presenceDropdownView']&&(this['view']['inlineListView']['isExpanded']=!0x1,this['balloonPanelView']['unpin'](),this['balloonPanelView']['content']['remove'](this['presenceDropdownView']),this['presenceDropdownView']['destroy'](),this['presenceDropdownView']=void 0x0);}['destroy'](){super['destroy'](),this['view']&&this['view']['isRendered']&&this['view']['destroy'](),this['_bodyCollection']&&(this['_bodyCollection']['detachFromDom'](),this['_bodyCollection']['destroy'](),this['_bodyCollection']=null);}}class s extends _0x2b8ee9{static get['requires'](){return[i,r];}static get['pluginName'](){return'PresenceList';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}export{a as CloudServicesCommentsAdapter,u as CloudServicesRevisionHistoryAdapter,f as CloudServicesTrackChangesAdapter,s as PresenceList,l as RealTimeCollaborationClient,m as RealTimeCollaborativeComments,n as RealTimeCollaborativeEditing,g as RealTimeCollaborativeRevisionHistory,p as RealTimeCollaborativeTrackChanges};